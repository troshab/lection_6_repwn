# Task 07: Hidden HTTP Server + strace

## üìã –û–ø–∏—Å –∑–∞–≤–¥–∞–Ω–Ω—è

–ü—Ä–æ–≥—Ä–∞–º–∞ **—Ç–∞—î–º–Ω–æ –∑–∞–ø—É—Å–∫–∞—î HTTP —Å–µ—Ä–≤–µ—Ä** –Ω–∞ localhost! –°—Ç–∞—Ç–∏—á–Ω–∏–π —Ç–∞ –Ω–∞–≤—ñ—Ç—å –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ —á–µ—Ä–µ–∑ GDB –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ - –ø–æ—Ç—Ä—ñ–±–µ–Ω **strace** –¥–ª—è —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤.

**–†—ñ–≤–µ–Ω—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –ï–∫—Å–ø–µ—Ä—Ç–Ω–∏–π | **–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:** System calls tracing, Network analysis

## üéØ –ù–∞–≤—á–∞–ª—å–Ω–∞ –º–µ—Ç–∞

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ strace –¥–ª—è —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤
- –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ä–µ–∂–µ–≤—É –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–∏
- –í–∏—è–≤–ª—è—Ç–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
- –ü—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ fork() —Ç–∞ –¥–æ—á—ñ—Ä–Ω—ñ–º–∏ –ø—Ä–æ—Ü–µ—Å–∞–º–∏
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ curl –¥–ª—è HTTP –∑–∞–ø–∏—Ç—ñ–≤

## üìö –©–æ —Ç–∞–∫–µ strace?

**strace** - —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤ Linux –ø—Ä–æ–≥—Ä–∞–º–∏.

**–©–æ –≤—ñ–Ω –ø–æ–∫–∞–∑—É—î:**
- –í–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π —è–¥—Ä–∞ (open, read, write, socket, bind, etc.)
- –ê—Ä–≥—É–º–µ–Ω—Ç–∏ —Ü–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π
- –ü–æ–≤–µ—Ä–Ω–µ–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
- –°–∏–≥–Ω–∞–ª–∏ —Ç–∞ –ø–æ–º–∏–ª–∫–∏

**–ß–æ–º—É –∫–æ—Ä–∏—Å–Ω–∏–π:**
- –í–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏
- Debugging –±–µ–∑ –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –∫–æ–¥—É
- –ê–Ω–∞–ª—ñ–∑ –º–∞–ª–≤–∞—Ä—É
- –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

## üõ†Ô∏è –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è strace

```bash
# Ubuntu/Debian
sudo apt install strace

# Fedora
sudo dnf install strace

# Arch
sudo pacman -S strace
```

### –ó–±—ñ—Ä–∫–∞

```bash
cd task07_hidden_http_strace
./build.sh
```

## üîç –ü–æ–∫—Ä–æ–∫–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è

### –ö—Ä–æ–∫ 1: –ó–≤–∏—á–∞–π–Ω–∏–π –∑–∞–ø—É—Å–∫

```bash
./build/re107 Alice
```

**–í–∏–≤—ñ–¥:**
```
(–ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —ñ –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É)
```

–ù—ñ—á–æ–≥–æ —Ü—ñ–∫–∞–≤–æ–≥–æ... –ê–±–æ –Ω—ñ?

### –ö—Ä–æ–∫ 2: –ê–Ω–∞–ª—ñ–∑ —á–µ—Ä–µ–∑ strings

```bash
strings -a build/re107 | grep -i flag
```

**–í–∏–≤—ñ–¥:**
```
FLAG{task7_ok_%s}
```

–ë–∞—á–∏–º–æ —Ñ–æ—Ä–º–∞—Ç FLAG, –∞–ª–µ —è–∫ –π–æ–≥–æ –æ—Ç—Ä–∏–º–∞—Ç–∏?

### –ö—Ä–æ–∫ 3: –ê–Ω–∞–ª—ñ–∑ —á–µ—Ä–µ–∑ GDB

```gdb
gdb build/re107
(gdb) break main
(gdb) run Alice
(gdb) continue
```

–ü—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è... –ú–æ–∂–ª–∏–≤–æ fork()?

### –ö—Ä–æ–∫ 4: strace - –±–∞–∑–æ–≤–∏–π –∑–∞–ø—É—Å–∫

```bash
strace ./build/re107 Alice
```

**–ß–∞—Å—Ç–∏–Ω–∞ –≤–∏–≤–æ–¥—É (–±–∞–≥–∞—Ç–æ —Ç–µ–∫—Å—Ç—É!):**
```
execve("./build/re107", ["./build/re107", "Alice"], ...) = 0
...
fork()                                  = 12345  ‚Üê AHA! Fork!
...
```

–ë–∞—á–∏–º–æ `fork()` - –ø—Ä–æ–≥—Ä–∞–º–∞ —Å—Ç–≤–æ—Ä—é—î –¥–æ—á—ñ—Ä–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å!

#### –©–æ —Ç–∞–∫–µ fork() –¥–ª—è –Ω–æ–≤–∞—á–∫—ñ–≤?

**fork()** - —Ü–µ —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫ Linux, —è–∫–∏–π —Å—Ç–≤–æ—Ä—é—î –∫–æ–ø—ñ—é –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É.

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

```
–î–æ fork():
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ü—Ä–æ—Ü–µ—Å (PID)   ‚îÇ
‚îÇ   ./re107        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

fork() –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è...

–ü—ñ—Å–ª—è fork():
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π     ‚îÇ       ‚îÇ –î–æ—á—ñ—Ä–Ω—ñ–π         ‚îÇ
‚îÇ –ø—Ä–æ—Ü–µ—Å (PID)     ‚îÇ       ‚îÇ –ø—Ä–æ—Ü–µ—Å (–Ω–æ–≤–∏–π    ‚îÇ
‚îÇ                  ‚îÇ       ‚îÇ PID)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–©–æ –æ—Ç—Ä–∏–º—É—î –∫–æ–∂–µ–Ω –ø—Ä–æ—Ü–µ—Å –ø—ñ—Å–ª—è fork():**

```c
pid_t pid = fork();

// –ü—ñ—Å–ª—è –≤–∏–∫–ª–∏–∫—É —î –î–í–ê –ø—Ä–æ—Ü–µ—Å–∏, –æ–±–∏–¥–≤–∞ –≤–∏–∫–æ–Ω—É—é—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥!

if (pid == 0) {
    // –¶–µ –¥–æ—á—ñ—Ä–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å
    // pid = 0 –æ–∑–Ω–∞—á–∞—î "—è –¥–∏—Ç–∏–Ω–∞"
    printf("–Ø –¥–æ—á—ñ—Ä–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å!\n");
} else if (pid > 0) {
    // –¶–µ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –ø—Ä–æ—Ü–µ—Å
    // pid = PID –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É
    printf("–Ø –±–∞—Ç—å–∫–æ, –º—ñ–π —Å–∏–Ω –º–∞—î PID %d\n", pid);
} else {
    // pid < 0 –æ–∑–Ω–∞—á–∞—î –ø–æ–º–∏–ª–∫—É
    perror("fork failed");
}
```

**–ù–∞–≤—ñ—â–æ fork() –≤ —Ü—å–æ–º—É –∑–∞–≤–¥–∞–Ω–Ω—ñ?**

```
–ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –ø—Ä–æ—Ü–µ—Å:
- –®–≤–∏–¥–∫–æ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è
- –ó–¥–∞—î—Ç—å—Å—è —â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç—å

–î–æ—á—ñ—Ä–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å:
- –ó–∞–ø—É—Å–∫–∞—î HTTP —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–∞—Ü—é—î —É —Ñ–æ–Ω—ñ
- –ü—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è –≤—ñ–¥ –ø–æ–≤–µ—Ä—Ö–Ω–µ–≤–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É!
```

**–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è:**
```
$ ./build/re107 Alice
                ‚Üì
          fork() –≤–∏–∫–ª–∏–∫
          ‚Üô           ‚Üò
   –ë–∞—Ç—å–∫–æ              –î–∏—Ç–∏–Ω–∞
     ‚Üì                   ‚Üì
  exit(0)         –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞
     ‚Üì              –Ω–∞ –ø–æ—Ä—Ç—ñ 31337
  –ó–∞–≤–µ—Ä—à–∏–≤—Å—è           ‚Üì
                  listen() ‚Üí accept()
                       ‚Üì
                  –û—á—ñ–∫—É—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
```

**–ß–æ–º—É strace -f –ø–æ—Ç—Ä—ñ–±–µ–Ω:**

–ë–µ–∑ `-f`:
- strace —Å—Ç–µ–∂–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –∑–∞ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–º –ø—Ä–æ—Ü–µ—Å–æ–º
- –ë–∞—Ç—å–∫–æ —à–≤–∏–¥–∫–æ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è
- –ù–µ –±–∞—á–∏–º–æ —â–æ —Ä–æ–±–∏—Ç—å –¥–∏—Ç–∏–Ω–∞!

–ó `-f`:
- strace —Å—Ç–µ–∂–∏—Ç—å –∑–∞ –±–∞—Ç—å–∫–æ–º **—ñ –¥—ñ—Ç—å–º–∏**
- –ë–∞—á–∏–º–æ –≤—Å—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É
- –í–∏—è–≤–ª—è—î–º–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π HTTP —Å–µ—Ä–≤–µ—Ä!

### –ö—Ä–æ–∫ 5: strace –∑ —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è–º —Ñ–æ—Ä–∫—ñ–≤

```bash
strace -f ./build/re107 Alice
```

**–û–ø—Ü—ñ—è `-f`** - —Å—Ç–µ–∂–∏—Ç–∏ –∑–∞ –¥–æ—á—ñ—Ä–Ω—ñ–º–∏ –ø—Ä–æ—Ü–µ—Å–∞–º–∏!

**–í–∏–≤—ñ–¥ (–∑–Ω–∞–π–¥–µ–º–æ –≤ —Ç—Ä–∞—Å—ñ –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É):**
```
[pid 12345] socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) = 3
[pid 12345] setsockopt(3, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0
[pid 12345] bind(3, {sa_family=AF_INET, sin_port=htons(31337),
                       sin_addr=inet_addr("127.0.0.1")}, 16) = 0
[pid 12345] listen(3, 8) = 0
[pid 12345] accept(3, NULL, NULL
```

**JACKPOT!** –ë–∞—á–∏–º–æ:
- `socket()` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–æ–∫–µ—Ç–∞
- `bind()` - –ø—Ä–∏–≤'—è–∑–∫–∞ –¥–æ **–ø–æ—Ä—Ç—É 31337** –Ω–∞ **127.0.0.1**
- `listen()` - –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω—å
- `accept()` - –ø—Ä–∏–π–æ–º –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

### –ö—Ä–æ–∫ 6: –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ –º–µ—Ä–µ–∂–µ–≤–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤

```bash
strace -f -e trace=%network -s 200 ./build/re107 Alice
```

**–û–ø—Ü—ñ—ó:**
- `-f` - —Å—Ç–µ–∂–∏—Ç–∏ –∑–∞ —Ñ–æ—Ä–∫–∞–º–∏
- `-e trace=%network` - —Ç—ñ–ª—å–∫–∏ –º–µ—Ä–µ–∂–µ–≤—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–∫–ª–∏–∫–∏
- `-s 200` - –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –¥–æ 200 —Å–∏–º–≤–æ–ª—ñ–≤ —Ä—è–¥–∫–æ–≤–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤

**–í–∏–≤—ñ–¥ (—á–∏—Å—Ç—ñ—à–∏–π):**
```
socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) = 3
setsockopt(3, SOL_SOCKET, SO_REUSEADDR, [1], 4) = 0
bind(3, {sa_family=AF_INET, sin_port=htons(31337),
         sin_addr=inet_addr("127.0.0.1")}, 16) = 0
listen(3, 8) = 0
accept(3, NULL, NULL) = 4
recv(4, "GET / HTTP/1.1\r\nHost: 127.0.0.1:31337\r\n...", 1023, 0) = ...
send(4, "HTTP/1.1 200 OK\r\nContent-Type: text/plain\r\n...", ..., 0) = ...
send(4, "FLAG{task7_ok_Alice}\n", 21, 0) = 21
```

**–¢–µ–ø–µ—Ä –≤—Å–µ –∑—Ä–æ–∑—É–º—ñ–ª–æ:**
1. –ü—Ä–æ–≥—Ä–∞–º–∞ —Å—Ç–∞—Ä—Ç—É—î HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ `127.0.0.1:31337`
2. –û—á—ñ–∫—É—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
3. –ü–æ–≤–µ—Ä—Ç–∞—î FLAG –≤ HTTP –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ!

### –ö—Ä–æ–∫ 7: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ curl

**–£ –ù–û–í–û–ú–£ –¢–ï–†–ú–Ü–ù–ê–õ–Ü** (–ø–æ–∫–∏ strace –ø—Ä–∞—Ü—é—î):

```bash
curl http://127.0.0.1:31337/?name=Alice
```

**–í–∏–≤—ñ–¥:**
```
FLAG{task7_ok_Alice}
```

üéâ **–£—Å–ø—ñ—Ö!**

### –ö—Ä–æ–∫ 8: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è (background process)

```bash
# –ó–∞–ø—É—Å–∫–∞—î–º–æ —É —Ñ–æ–Ω—ñ
./build/re107 Alice &
PID=$!

# –î–∞—î–º–æ —á–∞—Å —Å—Ç–∞—Ä—Ç—É–≤–∞—Ç–∏
sleep 0.5

# –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ—Å—å
curl http://127.0.0.1:31337/?name=Alice

# –í–±–∏–≤–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å
kill $PID
```

–ê–±–æ –≤ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É:

```bash
./build/re107 Alice & sleep 0.5 && curl http://127.0.0.1:31337/?name=Alice && kill $!
```

## üéì strace –ü–æ–≥–ª–∏–±–ª–µ–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

### –í–∞–∂–ª–∏–≤—ñ –æ–ø—Ü—ñ—ó strace

```bash
# –ë–∞–∑–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
strace ./program

# –°—Ç–µ–∂–∏—Ç–∏ –∑–∞ —Ñ–æ—Ä–∫–∞–º–∏
strace -f ./program

# –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –≤–∏–∫–ª–∏–∫–∏
strace -e trace=open,read ./program       # –¢—ñ–ª—å–∫–∏ open —Ç–∞ read
strace -e trace=%file ./program           # –§–∞–π–ª–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
strace -e trace=%network ./program        # –ú–µ—Ä–µ–∂–µ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
strace -e trace=%process ./program        # Process management
strace -e trace=%signal ./program         # –°–∏–≥–Ω–∞–ª–∏

# –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ –¥–∞–Ω–∏—Ö
strace -s 1000 ./program                  # –†—è–¥–∫–∏ –¥–æ 1000 —Å–∏–º–≤–æ–ª—ñ–≤

# –ü–∏—Å–∞—Ç–∏ —É —Ñ–∞–π–ª
strace -o output.txt ./program

# –û–∫—Ä–µ–º—ñ —Ñ–∞–π–ª–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É
strace -ff -o trace ./program
# –°—Ç–≤–æ—Ä–∏—Ç—å trace.PID —Ñ–∞–π–ª–∏

# –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —á–∞—Å
strace -t ./program                       # HH:MM:SS
strace -tt ./program                      # HH:MM:SS.microseconds
strace -T ./program                       # –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É
```

### –¢–∏–ø–∏ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤

#### %network (–º–µ—Ä–µ–∂–µ–≤—ñ)
- `socket()` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–æ–∫–µ—Ç–∞
- `bind()` - –ø—Ä–∏–≤'—è–∑–∫–∞ –¥–æ –∞–¥—Ä–µ—Å–∏/–ø–æ—Ä—Ç—É
- `listen()` - –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω—å
- `accept()` - –ø—Ä–∏–π–æ–º –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- `connect()` - –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
- `send()/recv()` - –≤—ñ–¥–ø—Ä–∞–≤–∫–∞/–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- `sendto()/recvfrom()` - UDP –æ–ø–µ—Ä–∞—Ü—ñ—ó

#### %file (—Ñ–∞–π–ª–æ–≤—ñ)
- `open()` - –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª
- `read()` - —á–∏—Ç–∞—Ç–∏
- `write()` - –ø–∏—Å–∞—Ç–∏
- `close()` - –∑–∞–∫—Ä–∏—Ç–∏
- `stat()` - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ–∞–π–ª

#### %process (–ø—Ä–æ—Ü–µ—Å–∏)
- `fork()` - —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ—á—ñ—Ä–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å
- `execve()` - –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É
- `wait()` - —á–µ–∫–∞—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ
- `kill()` - –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —Å–∏–≥–Ω–∞–ª

### –ü—Ä–∏–∫–ª–∞–¥ –¥–µ—Ç–∞–ª—å–Ω–æ—ó —Ç—Ä–∞—Å–∏

```bash
strace -ff -o trace -s 10000 ./build/re107 Alice
```

–°—Ç–≤–æ—Ä–∏—Ç—å —Ñ–∞–π–ª–∏:
- `trace.12345` - –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –ø—Ä–æ—Ü–µ—Å
- `trace.12346` - –¥–æ—á—ñ—Ä–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å (HTTP —Å–µ—Ä–≤–µ—Ä)

**–ê–Ω–∞–ª—ñ–∑ –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ:**
```bash
cat trace.12346 | grep -E "socket|bind|listen|accept|send"
```

## üí° Real-World –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è

### –í–∏—è–≤–ª–µ–Ω–Ω—è –º–∞–ª–≤–∞—Ä—É

```bash
# –©–æ —Ä–æ–±–∏—Ç—å –ø—ñ–¥–æ–∑—Ä—ñ–ª–∞ –ø—Ä–æ–≥—Ä–∞–º–∞?
strace -f -e trace=%network,% file ./suspicious_binary

# –®—É–∫–∞—î–º–æ:
# - –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ C&C —Å–µ—Ä–≤–µ—Ä—ñ–≤
# - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —É —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è—Ö
# - –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—é –∫–æ–Ω—Ñ—ñ–≥—ñ–≤
```

### Debugging –±–µ–∑ –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –∫–æ–¥—É

```bash
# –ß–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–µ –º–æ–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª?
strace -e trace=open ./program 2>&1 | grep ENOENT

# –Ø–∫—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è?
strace -e trace=open ./program 2>&1 | grep "\.so"
```

### –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

```bash
# –Ø–∫—ñ –≤–∏–∫–ª–∏–∫–∏ –Ω–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à—ñ?
strace -T -c ./program

# –í–∏–≤—ñ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
# % time  seconds  usecs/call  calls  errors  syscall
# ------ --------- ----------- ------ ------- --------
#  99.99  0.123456        1234    100       0 read
```

## üèÅ –ß–µ–∫–ª–∏—Å—Ç

- [ ] –í—Å—Ç–∞–Ω–æ–≤–∏–≤ strace
- [ ] –ó—ñ–±—Ä–∞–≤ `build/re107`
- [ ] –ó–∞–ø—É—Å—Ç–∏–≤ `strace -f ./build/re107 Alice`
- [ ] –ü–æ–±–∞—á–∏–≤ `fork()` —É —Ç—Ä–∞—Å—ñ
- [ ] –í–∏–∫–æ—Ä–∏—Å—Ç–∞–≤ `-e trace=%network` –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
- [ ] –ó–Ω–∞–π—à–æ–≤ –ø–æ—Ä—Ç **31337** —É `bind()`
- [ ] –ü—ñ–¥–∫–ª—é—á–∏–≤—Å—è —á–µ—Ä–µ–∑ `curl`
- [ ] –û—Ç—Ä–∏–º–∞–≤ FLAG

## üìñ –†–µ—Å—É—Ä—Å–∏

- `man strace` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- [strace.io](https://strace.io/) - –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π —Å–∞–π—Ç
- [Brendan Gregg's Blog](http://www.brendangregg.com/blog/2014-05-11/strace-wow-much-syscall.html)
- [ltrace](https://man7.org/linux/man-pages/man1/ltrace.1.html) - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è library calls

## üéØ –ü—ñ–¥—Å—É–º–æ–∫ –∫—É—Ä—Å—É

**–í—ñ—Ç–∞—î–º–æ!** –í–∏ –ø—Ä–æ–π—à–ª–∏ –≤—Å—ñ 7 –∑–∞–≤–¥–∞–Ω—å –∑ RE:

1. ‚≠ê **Inventory** - file, readelf, objdump, strings
2. ‚≠ê **Hardcoded** - strings, grep
3. ‚≠ê‚≠ê **ROT13** - GDB, –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑
4. ‚≠ê‚≠ê‚≠ê **ROT-N(strlen)** - Ghidra, –¥–µ–∫–æ–º–ø—ñ–ª—è—Ü—ñ—è
5. ‚≠ê‚≠ê‚≠ê‚≠ê **ROT-N(time)** - –∫–µ–π–≥–µ–Ω–∏, time-based
6. ‚≠ê‚≠ê‚≠ê **UPX** - –ø–∞–∫—É–≤–∞–Ω–Ω—è/—Ä–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è
7. ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê **HTTP** - strace, system calls

**–ù–∞–±—É—Ç—ñ –Ω–∞–≤–∏—á–∫–∏:**
- –°—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ (strings, readelf, objdump, Ghidra)
- –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ (GDB, breakpoints, memory inspection)
- –¢—Ä–∞—Å—É–≤–∞–Ω–Ω—è (strace, ltrace)
- –†–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è (UPX)
- –ù–∞–ø–∏—Å–∞–Ω–Ω—è –∫–µ–π–≥–µ–Ω—ñ–≤ (Python, –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—è)
- –ú–µ—Ä–µ–∂–µ–≤–∏–π –∞–Ω–∞–ª—ñ–∑ (curl, HTTP)

**–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:**
- PWN –∑–∞–≤–¥–∞–Ω–Ω—è (buffer overflow, ROP)
- –ë—ñ–ª—å—à —Å–∫–ª–∞–¥–Ω–∞ –æ–±—Ñ—É—Å–∫–∞—Ü—ñ—è (anti-debug, VM)
- Reverse engineering real malware (—É controlled environment!)

---
**–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | **–ß–∞—Å:** 60-90 —Ö–≤ | **FLAG:** `FLAG{task7_ok_<name>}`
